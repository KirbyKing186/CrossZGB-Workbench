                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module Collision
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _RevertSRAM
                                     11 	.globl _tile_hit_y
                                     12 	.globl _tile_hit_x
                                     13 	.globl _tile_col_test_range_y
                                     14 	.globl _tile_col_test_range_x
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 	.area _HRAM
                                     19 ;--------------------------------------------------------
                                     20 ; ram data
                                     21 ;--------------------------------------------------------
                                     22 	.area _DATA
    00000000                         23 __save:
    00000000                         24 	.ds 1
                                     25 ;--------------------------------------------------------
                                     26 ; ram data
                                     27 ;--------------------------------------------------------
                                     28 	.area _INITIALIZED
    00000000                         29 _tile_hit_x::
    00000000                         30 	.ds 2
    00000002                         31 _tile_hit_y::
    00000002                         32 	.ds 2
                                     33 ;--------------------------------------------------------
                                     34 ; absolute external ram data
                                     35 ;--------------------------------------------------------
                                     36 	.area _DABS (ABS)
                                     37 ;--------------------------------------------------------
                                     38 ; global & static initialisations
                                     39 ;--------------------------------------------------------
                                     40 	.area _HOME
                                     41 	.area _GSINIT
                                     42 	.area _GSFINAL
                                     43 	.area _GSINIT
                                     44 ;--------------------------------------------------------
                                     45 ; Home
                                     46 ;--------------------------------------------------------
                                     47 	.area _HOME
                                     48 ;Collision.c:11: UINT8 tile_col_test_range_y(UINT8 tile_mask, UINT16 tx, UINT16 ty_start, UINT16 ty_end) NONBANKED {
                                     49 ;	---------------------------------
                                     50 ; Function tile_col_test_range_y
                                     51 ; ---------------------------------
    00000000                         52 _tile_col_test_range_y::
    00000000 E8 FB            [16]   53 	add	sp, #-5
    00000002 F8 04            [12]   54 	ldhl	sp,	#4
    00000004 77               [ 8]   55 	ld	(hl), a
                                     56 ;Collision.c:12: tile_hit_x = tx;
    00000005 21r00r00         [12]   57 	ld	hl, #_tile_hit_x
    00000008 7B               [ 4]   58 	ld	a, e
    00000009 22               [ 8]   59 	ld	(hl+), a
    0000000A 72               [ 8]   60 	ld	(hl), d
                                     61 ;Collision.c:13: tile_hit_y = ty_start;
    0000000B F8 07            [12]   62 	ldhl	sp,	#7
    0000000D 7E               [ 8]   63 	ld	a, (hl)
    0000000E EAr02r00         [16]   64 	ld	(#_tile_hit_y),a
    00000011 F8 08            [12]   65 	ldhl	sp,	#8
    00000013 7E               [ 8]   66 	ld	a, (hl)
    00000014 EAr03r00         [16]   67 	ld	(#_tile_hit_y + 1),a
                                     68 ;Collision.c:15: if (tile_hit_x >= scroll_tiles_w || tile_hit_y >= scroll_tiles_h) {
    00000017 D5               [16]   69 	push	de
    00000018 11r00r00         [12]   70 	ld	de, #_tile_hit_x
    0000001B 21r00r00         [12]   71 	ld	hl, #_scroll_tiles_w
    0000001E 1A               [ 8]   72 	ld	a, (de)
    0000001F 13               [ 8]   73 	inc	de
    00000020 96               [ 8]   74 	sub	a, (hl)
    00000021 23               [ 8]   75 	inc	hl
    00000022 1A               [ 8]   76 	ld	a, (de)
    00000023 9E               [ 8]   77 	sbc	a, (hl)
    00000024 D1               [12]   78 	pop	de
    00000025 30 10            [12]   79 	jr	NC, 00101$
    00000027 D5               [16]   80 	push	de
    00000028 11r02r00         [12]   81 	ld	de, #_tile_hit_y
    0000002B 21r00r00         [12]   82 	ld	hl, #_scroll_tiles_h
    0000002E 1A               [ 8]   83 	ld	a, (de)
    0000002F 13               [ 8]   84 	inc	de
    00000030 96               [ 8]   85 	sub	a, (hl)
    00000031 23               [ 8]   86 	inc	hl
    00000032 1A               [ 8]   87 	ld	a, (de)
    00000033 9E               [ 8]   88 	sbc	a, (hl)
    00000034 D1               [12]   89 	pop	de
    00000035 38 10            [12]   90 	jr	C, 00102$
    00000037                         91 00101$:
                                     92 ;Collision.c:16: return (COLLISION_ALL & tile_mask) ? COLLISION_ALL : COLLISION_NONE;
    00000037 F8 04            [12]   93 	ldhl	sp,	#4
    00000039 7E               [ 8]   94 	ld	a, (hl)
    0000003A E6 0F            [ 8]   95 	and	a, #0x0f
    0000003C 28 05            [12]   96 	jr	Z, 00132$
    0000003E 3E 0F            [ 8]   97 	ld	a, #0x0f
    00000040 C3r9Dr01         [16]   98 	jp	00130$
    00000043                         99 00132$:
    00000043 AF               [ 4]  100 	xor	a, a
    00000044 C3r9Dr01         [16]  101 	jp	00130$
    00000047                        102 00102$:
                                    103 ;Collision.c:19: _save = CURRENT_BANK;
    00000047 F0r00            [12]  104 	ldh	a, (__current_bank + 0)
    00000049 EAr00r00         [16]  105 	ld	(#__save),a
                                    106 ;Collision.c:20: UINT8 inc = (ty_start < ty_end);
    0000004C D5               [16]  107 	push	de
    0000004D F8 09            [12]  108 	ldhl	sp,	#9
    0000004F 5D               [ 4]  109 	ld	e, l
    00000050 54               [ 4]  110 	ld	d, h
    00000051 F8 0B            [12]  111 	ldhl	sp,	#11
    00000053 1A               [ 8]  112 	ld	a, (de)
    00000054 13               [ 8]  113 	inc	de
    00000055 96               [ 8]  114 	sub	a, (hl)
    00000056 23               [ 8]  115 	inc	hl
    00000057 1A               [ 8]  116 	ld	a, (de)
    00000058 9E               [ 8]  117 	sbc	a, (hl)
    00000059 D1               [12]  118 	pop	de
    0000005A 3E 00            [ 8]  119 	ld	a, #0x00
    0000005C 17               [ 4]  120 	rla
    0000005D F8 02            [12]  121 	ldhl	sp,	#2
    0000005F 77               [ 8]  122 	ld	(hl), a
                                    123 ;Collision.c:21: SWITCH_ROM(scroll_bank);
    00000060 FAr00r00         [16]  124 	ld	a, (_scroll_bank)
    00000063 E0r00            [12]  125 	ldh	(__current_bank + 0), a
    00000065 EAr00r00         [16]  126 	ld	(#_rROMB0),a
                                    127 ;Collision.c:22: UINT8* tile_ptr = scroll_map + (((UINT16)ty_start * scroll_tiles_w) + tx);
    00000068 D5               [16]  128 	push	de
    00000069 FAr00r00         [16]  129 	ld	a, (_scroll_tiles_w)
    0000006C 4F               [ 4]  130 	ld	c, a
    0000006D 21r01r00         [12]  131 	ld	hl, #_scroll_tiles_w + 1
    00000070 46               [ 8]  132 	ld	b, (hl)
    00000071 F8 09            [12]  133 	ldhl	sp,	#9
    00000073 2A               [ 8]  134 	ld	a, (hl+)
    00000074 5F               [ 4]  135 	ld	e, a
    00000075 56               [ 8]  136 	ld	d, (hl)
    00000076 CDr00r00         [24]  137 	call	__mulint
    00000079 69               [ 4]  138 	ld	l, c
    0000007A 60               [ 4]  139 	ld	h, b
    0000007B D1               [12]  140 	pop	de
    0000007C 19               [ 8]  141 	add	hl, de
    0000007D 4D               [ 4]  142 	ld	c, l
    0000007E 44               [ 4]  143 	ld	b, h
    0000007F 79               [ 4]  144 	ld	a, c
    00000080 21r00r00         [12]  145 	ld	hl, #_scroll_map
    00000083 86               [ 8]  146 	add	a, (hl)
    00000084 23               [ 8]  147 	inc	hl
    00000085 4F               [ 4]  148 	ld	c, a
    00000086 78               [ 4]  149 	ld	a, b
    00000087 8E               [ 8]  150 	adc	a, (hl)
    00000088 47               [ 4]  151 	ld	b, a
                                    152 ;Collision.c:23: if (dynamic_map_active) ENABLE_RAM;
    00000089 FAr00r00         [16]  153 	ld	a, (#_dynamic_map_active)
    0000008C B7               [ 4]  154 	or	a, a
    0000008D 28 05            [12]  155 	jr	Z, 00145$
    0000008F 21r00r00         [12]  156 	ld	hl, #_rRAMG
    00000092 36 0A            [12]  157 	ld	(hl), #0x0a
                                    158 ;Collision.c:25: while (TRUE) {
    00000094                        159 00145$:
    00000094                        160 00126$:
                                    161 ;Collision.c:26: if (dynamic_map_active) {
    00000094 FAr00r00         [16]  162 	ld	a, (#_dynamic_map_active)
    00000097 B7               [ 4]  163 	or	a, a
    00000098 28 54            [12]  164 	jr	Z, 00110$
                                    165 ;Collision.c:27: if ((tile_ptr - scroll_map) >= BUFFER_SIZE) {
    0000009A 21r00r00         [12]  166 	ld	hl, #_scroll_map
    0000009D 2A               [ 8]  167 	ld	a, (hl+)
    0000009E 5F               [ 4]  168 	ld	e, a
    0000009F 56               [ 8]  169 	ld	d, (hl)
    000000A0 79               [ 4]  170 	ld	a, c
    000000A1 93               [ 4]  171 	sub	a, e
    000000A2 5F               [ 4]  172 	ld	e, a
    000000A3 78               [ 4]  173 	ld	a, b
    000000A4 9A               [ 4]  174 	sbc	a, d
    000000A5 F8 01            [12]  175 	ldhl	sp,	#1
    000000A7 32               [ 8]  176 	ld	(hl-), a
    000000A8 73               [ 8]  177 	ld	(hl), e
    000000A9 2A               [ 8]  178 	ld	a, (hl+)
    000000AA D6 00            [ 8]  179 	sub	a, #0x00
    000000AC 7E               [ 8]  180 	ld	a, (hl)
    000000AD DE 20            [ 8]  181 	sbc	a, #0x20
    000000AF 56               [ 8]  182 	ld	d, (hl)
    000000B0 3E 20            [ 8]  183 	ld	a, #0x20
    000000B2 CB 7F            [ 8]  184 	bit	7,a
    000000B4 28 07            [12]  185 	jr	Z, 00235$
    000000B6 CB 7A            [ 8]  186 	bit	7, d
    000000B8 20 08            [12]  187 	jr	NZ, 00236$
    000000BA BF               [ 4]  188 	cp	a, a
    000000BB 18 05            [12]  189 	jr	00236$
    000000BD                        190 00235$:
    000000BD CB 7A            [ 8]  191 	bit	7, d
    000000BF 28 01            [12]  192 	jr	Z, 00236$
    000000C1 37               [ 4]  193 	scf
    000000C2                        194 00236$:
    000000C2 38 17            [12]  195 	jr	C, 00107$
                                    196 ;Collision.c:28: SWITCH_RAM(RAM_DATA_B);
    000000C4 21r00r00         [12]  197 	ld	hl, #_rRAMB
    000000C7 36 02            [12]  198 	ld	(hl), #0x02
                                    199 ;Collision.c:29: tile = scroll_collisions[*(tile_ptr - BUFFER_SIZE)];
    000000C9 69               [ 4]  200 	ld	l, c
    000000CA 78               [ 4]  201 	ld	a,b
    000000CB C6 E0            [ 8]  202 	add	a,#0xe0
    000000CD 67               [ 4]  203 	ld	h, a
    000000CE 6E               [ 8]  204 	ld	l, (hl)
    000000CF 26 00            [ 8]  205 	ld	h, #0x00
    000000D1 11r00r00         [12]  206 	ld	de, #_scroll_collisions
    000000D4 19               [ 8]  207 	add	hl, de
    000000D5 7E               [ 8]  208 	ld	a, (hl)
    000000D6 F8 03            [12]  209 	ldhl	sp,	#3
    000000D8 77               [ 8]  210 	ld	(hl), a
    000000D9 18 1F            [12]  211 	jr	00111$
    000000DB                        212 00107$:
                                    213 ;Collision.c:31: SWITCH_RAM(RAM_DATA_A);
    000000DB 21r00r00         [12]  214 	ld	hl, #_rRAMB
    000000DE 36 01            [12]  215 	ld	(hl), #0x01
                                    216 ;Collision.c:32: tile = scroll_collisions[*tile_ptr];
    000000E0 0A               [ 8]  217 	ld	a, (bc)
    000000E1 6F               [ 4]  218 	ld	l, a
    000000E2 26 00            [ 8]  219 	ld	h, #0x00
    000000E4 11r00r00         [12]  220 	ld	de, #_scroll_collisions
    000000E7 19               [ 8]  221 	add	hl, de
    000000E8 7E               [ 8]  222 	ld	a, (hl)
    000000E9 F8 03            [12]  223 	ldhl	sp,	#3
    000000EB 77               [ 8]  224 	ld	(hl), a
    000000EC 18 0C            [12]  225 	jr	00111$
    000000EE                        226 00110$:
                                    227 ;Collision.c:35: tile = scroll_collisions[*tile_ptr];
    000000EE 0A               [ 8]  228 	ld	a, (bc)
    000000EF 6F               [ 4]  229 	ld	l, a
    000000F0 26 00            [ 8]  230 	ld	h, #0x00
    000000F2 11r00r00         [12]  231 	ld	de, #_scroll_collisions
    000000F5 19               [ 8]  232 	add	hl, de
    000000F6 7E               [ 8]  233 	ld	a, (hl)
    000000F7 F8 03            [12]  234 	ldhl	sp,	#3
    000000F9 77               [ 8]  235 	ld	(hl), a
    000000FA                        236 00111$:
                                    237 ;Collision.c:38: SWITCH_ROM(_save);
    000000FA FAr00r00         [16]  238 	ld	a, (__save)
    000000FD 5F               [ 4]  239 	ld	e, a
                                    240 ;Collision.c:37: if (tile & tile_mask) {
    000000FE F8 03            [12]  241 	ldhl	sp,	#3
    00000100 2A               [ 8]  242 	ld	a, (hl+)
    00000101 A6               [ 8]  243 	and	a, (hl)
    00000102 28 16            [12]  244 	jr	Z, 00115$
                                    245 ;Collision.c:38: SWITCH_ROM(_save);
    00000104 7B               [ 4]  246 	ld	a, e
    00000105 E0r00            [12]  247 	ldh	(__current_bank + 0), a
    00000107 21r00r00         [12]  248 	ld	hl, #_rROMB0
    0000010A 73               [ 8]  249 	ld	(hl), e
                                    250 ;Collision.c:39: if (dynamic_map_active) RevertSRAM();
    0000010B FAr00r00         [16]  251 	ld	a, (#_dynamic_map_active)
    0000010E B7               [ 4]  252 	or	a, a
    0000010F 28 03            [12]  253 	jr	Z, 00113$
    00000111 CDr00r00         [24]  254 	call	_RevertSRAM
    00000114                        255 00113$:
                                    256 ;Collision.c:40: return tile;
    00000114 F8 03            [12]  257 	ldhl	sp,	#3
    00000116 7E               [ 8]  258 	ld	a, (hl)
    00000117 C3r9Dr01         [16]  259 	jp	00130$
    0000011A                        260 00115$:
                                    261 ;Collision.c:42: if (tile_hit_y == ty_end) {
    0000011A FAr02r00         [16]  262 	ld	a, (#_tile_hit_y)
    0000011D F8 09            [12]  263 	ldhl	sp,	#9
    0000011F 96               [ 8]  264 	sub	a, (hl)
    00000120 20 08            [12]  265 	jr	NZ, 00237$
    00000122 FAr03r00         [16]  266 	ld	a, (#_tile_hit_y + 1)
    00000125 F8 0A            [12]  267 	ldhl	sp,	#10
    00000127 96               [ 8]  268 	sub	a, (hl)
    00000128 28 62            [12]  269 	jr	Z, 00127$
    0000012A                        270 00237$:
                                    271 ;Collision.c:45: if (inc) {
    0000012A F8 02            [12]  272 	ldhl	sp,	#2
    0000012C 7E               [ 8]  273 	ld	a, (hl)
    0000012D B7               [ 4]  274 	or	a, a
    0000012E 28 14            [12]  275 	jr	Z, 00119$
                                    276 ;Collision.c:46: tile_hit_y++;
    00000130 21r02r00         [12]  277 	ld	hl, #_tile_hit_y
    00000133 34               [12]  278 	inc	(hl)
    00000134 20 02            [12]  279 	jr	NZ, 00238$
    00000136 23               [ 8]  280 	inc	hl
    00000137 34               [12]  281 	inc	(hl)
    00000138                        282 00238$:
                                    283 ;Collision.c:47: tile_ptr += scroll_tiles_w;
    00000138 79               [ 4]  284 	ld	a, c
    00000139 21r00r00         [12]  285 	ld	hl, #_scroll_tiles_w
    0000013C 86               [ 8]  286 	add	a, (hl)
    0000013D 23               [ 8]  287 	inc	hl
    0000013E 4F               [ 4]  288 	ld	c, a
    0000013F 78               [ 4]  289 	ld	a, b
    00000140 8E               [ 8]  290 	adc	a, (hl)
    00000141 47               [ 4]  291 	ld	b, a
    00000142 18 19            [12]  292 	jr	00120$
    00000144                        293 00119$:
                                    294 ;Collision.c:49: tile_hit_y--;
    00000144 21r02r00         [12]  295 	ld	hl, #_tile_hit_y
    00000147 7E               [ 8]  296 	ld	a, (hl)
    00000148 C6 FF            [ 8]  297 	add	a, #0xff
    0000014A 22               [ 8]  298 	ld	(hl+), a
    0000014B 7E               [ 8]  299 	ld	a, (hl)
    0000014C CE FF            [ 8]  300 	adc	a, #0xff
    0000014E 77               [ 8]  301 	ld	(hl), a
                                    302 ;Collision.c:50: tile_ptr -= scroll_tiles_w;
    0000014F FAr00r00         [16]  303 	ld	a, (_scroll_tiles_w)
    00000152 57               [ 4]  304 	ld	d, a
    00000153 21r01r00         [12]  305 	ld	hl, #_scroll_tiles_w + 1
    00000156 6E               [ 8]  306 	ld	l, (hl)
    00000157 79               [ 4]  307 	ld	a, c
    00000158 92               [ 4]  308 	sub	a, d
    00000159 4F               [ 4]  309 	ld	c, a
    0000015A 78               [ 4]  310 	ld	a, b
    0000015B 9D               [ 4]  311 	sbc	a, l
    0000015C 47               [ 4]  312 	ld	b, a
    0000015D                        313 00120$:
                                    314 ;Collision.c:52: if (tile_hit_y >= scroll_tiles_h) {
    0000015D D5               [16]  315 	push	de
    0000015E 11r02r00         [12]  316 	ld	de, #_tile_hit_y
    00000161 21r00r00         [12]  317 	ld	hl, #_scroll_tiles_h
    00000164 1A               [ 8]  318 	ld	a, (de)
    00000165 13               [ 8]  319 	inc	de
    00000166 96               [ 8]  320 	sub	a, (hl)
    00000167 23               [ 8]  321 	inc	hl
    00000168 1A               [ 8]  322 	ld	a, (de)
    00000169 9E               [ 8]  323 	sbc	a, (hl)
    0000016A D1               [12]  324 	pop	de
    0000016B DAr94r00         [16]  325 	jp	C, 00126$
                                    326 ;Collision.c:53: SWITCH_ROM(_save);
    0000016E 7B               [ 4]  327 	ld	a, e
    0000016F E0r00            [12]  328 	ldh	(__current_bank + 0), a
    00000171 21r00r00         [12]  329 	ld	hl, #_rROMB0
    00000174 73               [ 8]  330 	ld	(hl), e
                                    331 ;Collision.c:54: if (dynamic_map_active) RevertSRAM();
    00000175 FAr00r00         [16]  332 	ld	a, (#_dynamic_map_active)
    00000178 B7               [ 4]  333 	or	a, a
    00000179 28 03            [12]  334 	jr	Z, 00122$
    0000017B CDr00r00         [24]  335 	call	_RevertSRAM
    0000017E                        336 00122$:
                                    337 ;Collision.c:55: return (COLLISION_ALL & tile_mask) ? COLLISION_ALL : COLLISION_NONE;
    0000017E F8 04            [12]  338 	ldhl	sp,	#4
    00000180 7E               [ 8]  339 	ld	a, (hl)
    00000181 E6 0F            [ 8]  340 	and	a, #0x0f
    00000183 28 04            [12]  341 	jr	Z, 00134$
    00000185 3E 0F            [ 8]  342 	ld	a, #0x0f
    00000187 18 14            [12]  343 	jr	00130$
    00000189                        344 00134$:
    00000189 AF               [ 4]  345 	xor	a, a
    0000018A 18 11            [12]  346 	jr	00130$
    0000018C                        347 00127$:
                                    348 ;Collision.c:58: SWITCH_ROM(_save);
    0000018C 7B               [ 4]  349 	ld	a, e
    0000018D E0r00            [12]  350 	ldh	(__current_bank + 0), a
    0000018F 21r00r00         [12]  351 	ld	hl, #_rROMB0
    00000192 73               [ 8]  352 	ld	(hl), e
                                    353 ;Collision.c:59: if (dynamic_map_active) RevertSRAM();
    00000193 FAr00r00         [16]  354 	ld	a, (#_dynamic_map_active)
    00000196 B7               [ 4]  355 	or	a, a
    00000197 28 03            [12]  356 	jr	Z, 00129$
    00000199 CDr00r00         [24]  357 	call	_RevertSRAM
    0000019C                        358 00129$:
                                    359 ;Collision.c:60: return COLLISION_NONE;
    0000019C AF               [ 4]  360 	xor	a, a
    0000019D                        361 00130$:
                                    362 ;Collision.c:61: }
    0000019D E8 05            [16]  363 	add	sp, #5
    0000019F E1               [12]  364 	pop	hl
    000001A0 E8 04            [16]  365 	add	sp, #4
    000001A2 E9               [ 4]  366 	jp	(hl)
                                    367 ;Collision.c:63: UINT8 tile_col_test_range_x(UINT8 tile_mask, UINT16 ty, UINT16 tx_start, UINT16 tx_end) NONBANKED {
                                    368 ;	---------------------------------
                                    369 ; Function tile_col_test_range_x
                                    370 ; ---------------------------------
    000001A3                        371 _tile_col_test_range_x::
    000001A3 E8 FB            [16]  372 	add	sp, #-5
    000001A5 F8 04            [12]  373 	ldhl	sp,	#4
    000001A7 77               [ 8]  374 	ld	(hl), a
                                    375 ;Collision.c:64: tile_hit_x = tx_start;
    000001A8 F8 07            [12]  376 	ldhl	sp,	#7
    000001AA 7E               [ 8]  377 	ld	a, (hl)
    000001AB EAr00r00         [16]  378 	ld	(#_tile_hit_x),a
    000001AE F8 08            [12]  379 	ldhl	sp,	#8
    000001B0 7E               [ 8]  380 	ld	a, (hl)
    000001B1 EAr01r00         [16]  381 	ld	(#_tile_hit_x + 1),a
                                    382 ;Collision.c:65: tile_hit_y = ty;
    000001B4 21r02r00         [12]  383 	ld	hl, #_tile_hit_y
    000001B7 7B               [ 4]  384 	ld	a, e
    000001B8 22               [ 8]  385 	ld	(hl+), a
    000001B9 72               [ 8]  386 	ld	(hl), d
                                    387 ;Collision.c:67: if (tile_hit_x >= scroll_tiles_w || tile_hit_y >= scroll_tiles_h) {
    000001BA D5               [16]  388 	push	de
    000001BB 11r00r00         [12]  389 	ld	de, #_tile_hit_x
    000001BE 21r00r00         [12]  390 	ld	hl, #_scroll_tiles_w
    000001C1 1A               [ 8]  391 	ld	a, (de)
    000001C2 13               [ 8]  392 	inc	de
    000001C3 96               [ 8]  393 	sub	a, (hl)
    000001C4 23               [ 8]  394 	inc	hl
    000001C5 1A               [ 8]  395 	ld	a, (de)
    000001C6 9E               [ 8]  396 	sbc	a, (hl)
    000001C7 D1               [12]  397 	pop	de
    000001C8 30 10            [12]  398 	jr	NC, 00101$
    000001CA D5               [16]  399 	push	de
    000001CB 11r02r00         [12]  400 	ld	de, #_tile_hit_y
    000001CE 21r00r00         [12]  401 	ld	hl, #_scroll_tiles_h
    000001D1 1A               [ 8]  402 	ld	a, (de)
    000001D2 13               [ 8]  403 	inc	de
    000001D3 96               [ 8]  404 	sub	a, (hl)
    000001D4 23               [ 8]  405 	inc	hl
    000001D5 1A               [ 8]  406 	ld	a, (de)
    000001D6 9E               [ 8]  407 	sbc	a, (hl)
    000001D7 D1               [12]  408 	pop	de
    000001D8 38 10            [12]  409 	jr	C, 00102$
    000001DA                        410 00101$:
                                    411 ;Collision.c:68: return (COLLISION_ALL & tile_mask) ? COLLISION_ALL : COLLISION_NONE;
    000001DA F8 04            [12]  412 	ldhl	sp,	#4
    000001DC 7E               [ 8]  413 	ld	a, (hl)
    000001DD E6 0F            [ 8]  414 	and	a, #0x0f
    000001DF 28 05            [12]  415 	jr	Z, 00132$
    000001E1 3E 0F            [ 8]  416 	ld	a, #0x0f
    000001E3 C3r25r03         [16]  417 	jp	00130$
    000001E6                        418 00132$:
    000001E6 AF               [ 4]  419 	xor	a, a
    000001E7 C3r25r03         [16]  420 	jp	00130$
    000001EA                        421 00102$:
                                    422 ;Collision.c:71: _save = CURRENT_BANK;
    000001EA F0r00            [12]  423 	ldh	a, (__current_bank + 0)
    000001EC EAr00r00         [16]  424 	ld	(#__save),a
                                    425 ;Collision.c:72: UINT8 inc = (tx_start < tx_end);
    000001EF D5               [16]  426 	push	de
    000001F0 F8 09            [12]  427 	ldhl	sp,	#9
    000001F2 5D               [ 4]  428 	ld	e, l
    000001F3 54               [ 4]  429 	ld	d, h
    000001F4 F8 0B            [12]  430 	ldhl	sp,	#11
    000001F6 1A               [ 8]  431 	ld	a, (de)
    000001F7 13               [ 8]  432 	inc	de
    000001F8 96               [ 8]  433 	sub	a, (hl)
    000001F9 23               [ 8]  434 	inc	hl
    000001FA 1A               [ 8]  435 	ld	a, (de)
    000001FB 9E               [ 8]  436 	sbc	a, (hl)
    000001FC D1               [12]  437 	pop	de
    000001FD 3E 00            [ 8]  438 	ld	a, #0x00
    000001FF 17               [ 4]  439 	rla
    00000200 F8 02            [12]  440 	ldhl	sp,	#2
    00000202 77               [ 8]  441 	ld	(hl), a
                                    442 ;Collision.c:73: SWITCH_ROM(scroll_bank);
    00000203 FAr00r00         [16]  443 	ld	a, (_scroll_bank)
    00000206 E0r00            [12]  444 	ldh	(__current_bank + 0), a
    00000208 EAr00r00         [16]  445 	ld	(#_rROMB0),a
                                    446 ;Collision.c:74: UINT8* tile_ptr = scroll_map + (((UINT16)ty * scroll_tiles_w) + tx_start);
    0000020B FAr00r00         [16]  447 	ld	a, (_scroll_tiles_w)
    0000020E 4F               [ 4]  448 	ld	c, a
    0000020F 21r01r00         [12]  449 	ld	hl, #_scroll_tiles_w + 1
    00000212 46               [ 8]  450 	ld	b, (hl)
    00000213 CDr00r00         [24]  451 	call	__mulint
    00000216 F8 07            [12]  452 	ldhl	sp,	#7
    00000218 2A               [ 8]  453 	ld	a,	(hl+)
    00000219 66               [ 8]  454 	ld	h, (hl)
    0000021A 6F               [ 4]  455 	ld	l, a
    0000021B 09               [ 8]  456 	add	hl, bc
    0000021C 4D               [ 4]  457 	ld	c, l
    0000021D 44               [ 4]  458 	ld	b, h
    0000021E 79               [ 4]  459 	ld	a, c
    0000021F 21r00r00         [12]  460 	ld	hl, #_scroll_map
    00000222 86               [ 8]  461 	add	a, (hl)
    00000223 23               [ 8]  462 	inc	hl
    00000224 4F               [ 4]  463 	ld	c, a
    00000225 78               [ 4]  464 	ld	a, b
    00000226 8E               [ 8]  465 	adc	a, (hl)
    00000227 47               [ 4]  466 	ld	b, a
                                    467 ;Collision.c:76: if (dynamic_map_active) ENABLE_RAM;
    00000228 FAr00r00         [16]  468 	ld	a, (#_dynamic_map_active)
    0000022B B7               [ 4]  469 	or	a, a
    0000022C 28 05            [12]  470 	jr	Z, 00145$
    0000022E 21r00r00         [12]  471 	ld	hl, #_rRAMG
    00000231 36 0A            [12]  472 	ld	(hl), #0x0a
                                    473 ;Collision.c:77: while (TRUE) {
    00000233                        474 00145$:
    00000233                        475 00126$:
                                    476 ;Collision.c:78: if (dynamic_map_active) {
    00000233 FAr00r00         [16]  477 	ld	a, (#_dynamic_map_active)
    00000236 B7               [ 4]  478 	or	a, a
    00000237 28 54            [12]  479 	jr	Z, 00110$
                                    480 ;Collision.c:79: if ((tile_ptr - scroll_map) >= BUFFER_SIZE) {
    00000239 21r00r00         [12]  481 	ld	hl, #_scroll_map
    0000023C 2A               [ 8]  482 	ld	a, (hl+)
    0000023D 5F               [ 4]  483 	ld	e, a
    0000023E 56               [ 8]  484 	ld	d, (hl)
    0000023F 79               [ 4]  485 	ld	a, c
    00000240 93               [ 4]  486 	sub	a, e
    00000241 5F               [ 4]  487 	ld	e, a
    00000242 78               [ 4]  488 	ld	a, b
    00000243 9A               [ 4]  489 	sbc	a, d
    00000244 F8 01            [12]  490 	ldhl	sp,	#1
    00000246 32               [ 8]  491 	ld	(hl-), a
    00000247 73               [ 8]  492 	ld	(hl), e
    00000248 2A               [ 8]  493 	ld	a, (hl+)
    00000249 D6 00            [ 8]  494 	sub	a, #0x00
    0000024B 7E               [ 8]  495 	ld	a, (hl)
    0000024C DE 20            [ 8]  496 	sbc	a, #0x20
    0000024E 56               [ 8]  497 	ld	d, (hl)
    0000024F 3E 20            [ 8]  498 	ld	a, #0x20
    00000251 CB 7F            [ 8]  499 	bit	7,a
    00000253 28 07            [12]  500 	jr	Z, 00235$
    00000255 CB 7A            [ 8]  501 	bit	7, d
    00000257 20 08            [12]  502 	jr	NZ, 00236$
    00000259 BF               [ 4]  503 	cp	a, a
    0000025A 18 05            [12]  504 	jr	00236$
    0000025C                        505 00235$:
    0000025C CB 7A            [ 8]  506 	bit	7, d
    0000025E 28 01            [12]  507 	jr	Z, 00236$
    00000260 37               [ 4]  508 	scf
    00000261                        509 00236$:
    00000261 38 17            [12]  510 	jr	C, 00107$
                                    511 ;Collision.c:80: SWITCH_RAM(RAM_DATA_B);
    00000263 21r00r00         [12]  512 	ld	hl, #_rRAMB
    00000266 36 02            [12]  513 	ld	(hl), #0x02
                                    514 ;Collision.c:81: tile = scroll_collisions[*(tile_ptr - BUFFER_SIZE)];
    00000268 69               [ 4]  515 	ld	l, c
    00000269 78               [ 4]  516 	ld	a,b
    0000026A C6 E0            [ 8]  517 	add	a,#0xe0
    0000026C 67               [ 4]  518 	ld	h, a
    0000026D 6E               [ 8]  519 	ld	l, (hl)
    0000026E 26 00            [ 8]  520 	ld	h, #0x00
    00000270 11r00r00         [12]  521 	ld	de, #_scroll_collisions
    00000273 19               [ 8]  522 	add	hl, de
    00000274 7E               [ 8]  523 	ld	a, (hl)
    00000275 F8 03            [12]  524 	ldhl	sp,	#3
    00000277 77               [ 8]  525 	ld	(hl), a
    00000278 18 1F            [12]  526 	jr	00111$
    0000027A                        527 00107$:
                                    528 ;Collision.c:83: SWITCH_RAM(RAM_DATA_A);
    0000027A 21r00r00         [12]  529 	ld	hl, #_rRAMB
    0000027D 36 01            [12]  530 	ld	(hl), #0x01
                                    531 ;Collision.c:84: tile = scroll_collisions[*tile_ptr];
    0000027F 0A               [ 8]  532 	ld	a, (bc)
    00000280 6F               [ 4]  533 	ld	l, a
    00000281 26 00            [ 8]  534 	ld	h, #0x00
    00000283 11r00r00         [12]  535 	ld	de, #_scroll_collisions
    00000286 19               [ 8]  536 	add	hl, de
    00000287 7E               [ 8]  537 	ld	a, (hl)
    00000288 F8 03            [12]  538 	ldhl	sp,	#3
    0000028A 77               [ 8]  539 	ld	(hl), a
    0000028B 18 0C            [12]  540 	jr	00111$
    0000028D                        541 00110$:
                                    542 ;Collision.c:87: tile = scroll_collisions[*tile_ptr];
    0000028D 0A               [ 8]  543 	ld	a, (bc)
    0000028E 6F               [ 4]  544 	ld	l, a
    0000028F 26 00            [ 8]  545 	ld	h, #0x00
    00000291 11r00r00         [12]  546 	ld	de, #_scroll_collisions
    00000294 19               [ 8]  547 	add	hl, de
    00000295 7E               [ 8]  548 	ld	a, (hl)
    00000296 F8 03            [12]  549 	ldhl	sp,	#3
    00000298 77               [ 8]  550 	ld	(hl), a
    00000299                        551 00111$:
                                    552 ;Collision.c:90: SWITCH_ROM(_save);
    00000299 FAr00r00         [16]  553 	ld	a, (__save)
    0000029C 5F               [ 4]  554 	ld	e, a
                                    555 ;Collision.c:89: if (tile & tile_mask) {
    0000029D F8 03            [12]  556 	ldhl	sp,	#3
    0000029F 2A               [ 8]  557 	ld	a, (hl+)
    000002A0 A6               [ 8]  558 	and	a, (hl)
    000002A1 28 15            [12]  559 	jr	Z, 00115$
                                    560 ;Collision.c:90: SWITCH_ROM(_save);
    000002A3 7B               [ 4]  561 	ld	a, e
    000002A4 E0r00            [12]  562 	ldh	(__current_bank + 0), a
    000002A6 21r00r00         [12]  563 	ld	hl, #_rROMB0
    000002A9 73               [ 8]  564 	ld	(hl), e
                                    565 ;Collision.c:91: if (dynamic_map_active) RevertSRAM();
    000002AA FAr00r00         [16]  566 	ld	a, (#_dynamic_map_active)
    000002AD B7               [ 4]  567 	or	a, a
    000002AE 28 03            [12]  568 	jr	Z, 00113$
    000002B0 CDr00r00         [24]  569 	call	_RevertSRAM
    000002B3                        570 00113$:
                                    571 ;Collision.c:92: return tile;
    000002B3 F8 03            [12]  572 	ldhl	sp,	#3
    000002B5 7E               [ 8]  573 	ld	a, (hl)
    000002B6 18 6D            [12]  574 	jr	00130$
    000002B8                        575 00115$:
                                    576 ;Collision.c:94: if (tile_hit_x == tx_end) {
    000002B8 FAr00r00         [16]  577 	ld	a, (#_tile_hit_x)
    000002BB F8 09            [12]  578 	ldhl	sp,	#9
    000002BD 96               [ 8]  579 	sub	a, (hl)
    000002BE 20 08            [12]  580 	jr	NZ, 00237$
    000002C0 FAr01r00         [16]  581 	ld	a, (#_tile_hit_x + 1)
    000002C3 F8 0A            [12]  582 	ldhl	sp,	#10
    000002C5 96               [ 8]  583 	sub	a, (hl)
    000002C6 28 4C            [12]  584 	jr	Z, 00127$
    000002C8                        585 00237$:
                                    586 ;Collision.c:97: if (inc) {
    000002C8 F8 02            [12]  587 	ldhl	sp,	#2
    000002CA 7E               [ 8]  588 	ld	a, (hl)
    000002CB B7               [ 4]  589 	or	a, a
    000002CC 28 0B            [12]  590 	jr	Z, 00119$
                                    591 ;Collision.c:98: tile_hit_x++;
    000002CE 21r00r00         [12]  592 	ld	hl, #_tile_hit_x
    000002D1 34               [12]  593 	inc	(hl)
    000002D2 20 02            [12]  594 	jr	NZ, 00238$
    000002D4 23               [ 8]  595 	inc	hl
    000002D5 34               [12]  596 	inc	(hl)
    000002D6                        597 00238$:
                                    598 ;Collision.c:99: tile_ptr++;
    000002D6 03               [ 8]  599 	inc	bc
    000002D7 18 0C            [12]  600 	jr	00120$
    000002D9                        601 00119$:
                                    602 ;Collision.c:101: tile_hit_x--;
    000002D9 21r00r00         [12]  603 	ld	hl, #_tile_hit_x
    000002DC 7E               [ 8]  604 	ld	a, (hl)
    000002DD C6 FF            [ 8]  605 	add	a, #0xff
    000002DF 22               [ 8]  606 	ld	(hl+), a
    000002E0 7E               [ 8]  607 	ld	a, (hl)
    000002E1 CE FF            [ 8]  608 	adc	a, #0xff
    000002E3 77               [ 8]  609 	ld	(hl), a
                                    610 ;Collision.c:102: tile_ptr--;
    000002E4 0B               [ 8]  611 	dec	bc
    000002E5                        612 00120$:
                                    613 ;Collision.c:104: if (tile_hit_x >= scroll_tiles_w) {
    000002E5 D5               [16]  614 	push	de
    000002E6 11r00r00         [12]  615 	ld	de, #_tile_hit_x
    000002E9 21r00r00         [12]  616 	ld	hl, #_scroll_tiles_w
    000002EC 1A               [ 8]  617 	ld	a, (de)
    000002ED 13               [ 8]  618 	inc	de
    000002EE 96               [ 8]  619 	sub	a, (hl)
    000002EF 23               [ 8]  620 	inc	hl
    000002F0 1A               [ 8]  621 	ld	a, (de)
    000002F1 9E               [ 8]  622 	sbc	a, (hl)
    000002F2 D1               [12]  623 	pop	de
    000002F3 DAr33r02         [16]  624 	jp	C, 00126$
                                    625 ;Collision.c:105: SWITCH_ROM(_save);
    000002F6 7B               [ 4]  626 	ld	a, e
    000002F7 E0r00            [12]  627 	ldh	(__current_bank + 0), a
    000002F9 21r00r00         [12]  628 	ld	hl, #_rROMB0
    000002FC 73               [ 8]  629 	ld	(hl), e
                                    630 ;Collision.c:106: if (dynamic_map_active) RevertSRAM();
    000002FD FAr00r00         [16]  631 	ld	a, (#_dynamic_map_active)
    00000300 B7               [ 4]  632 	or	a, a
    00000301 28 03            [12]  633 	jr	Z, 00122$
    00000303 CDr00r00         [24]  634 	call	_RevertSRAM
    00000306                        635 00122$:
                                    636 ;Collision.c:107: return (COLLISION_ALL & tile_mask) ? COLLISION_ALL : COLLISION_NONE;
    00000306 F8 04            [12]  637 	ldhl	sp,	#4
    00000308 7E               [ 8]  638 	ld	a, (hl)
    00000309 E6 0F            [ 8]  639 	and	a, #0x0f
    0000030B 28 04            [12]  640 	jr	Z, 00134$
    0000030D 3E 0F            [ 8]  641 	ld	a, #0x0f
    0000030F 18 14            [12]  642 	jr	00130$
    00000311                        643 00134$:
    00000311 AF               [ 4]  644 	xor	a, a
    00000312 18 11            [12]  645 	jr	00130$
    00000314                        646 00127$:
                                    647 ;Collision.c:110: SWITCH_ROM(_save);
    00000314 7B               [ 4]  648 	ld	a, e
    00000315 E0r00            [12]  649 	ldh	(__current_bank + 0), a
    00000317 21r00r00         [12]  650 	ld	hl, #_rROMB0
    0000031A 73               [ 8]  651 	ld	(hl), e
                                    652 ;Collision.c:111: if (dynamic_map_active) RevertSRAM();
    0000031B FAr00r00         [16]  653 	ld	a, (#_dynamic_map_active)
    0000031E B7               [ 4]  654 	or	a, a
    0000031F 28 03            [12]  655 	jr	Z, 00129$
    00000321 CDr00r00         [24]  656 	call	_RevertSRAM
    00000324                        657 00129$:
                                    658 ;Collision.c:112: return COLLISION_NONE;
    00000324 AF               [ 4]  659 	xor	a, a
    00000325                        660 00130$:
                                    661 ;Collision.c:113: }
    00000325 E8 05            [16]  662 	add	sp, #5
    00000327 E1               [12]  663 	pop	hl
    00000328 E8 04            [16]  664 	add	sp, #4
    0000032A E9               [ 4]  665 	jp	(hl)
                                    666 	.area _HOME
                                    667 ;--------------------------------------------------------
                                    668 ; code
                                    669 ;--------------------------------------------------------
                                    670 	.area _CODE
                                    671 	.area _CODE
                                    672 	.area _INITIALIZER
    00000000                        673 __xinit__tile_hit_x:
    00000000 00 00                  674 	.dw #0x0000
    00000002                        675 __xinit__tile_hit_y:
    00000002 00 00                  676 	.dw #0x0000
                                    677 	.area _CABS (ABS)
