                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module Camera
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _MoveScroll
                                     11 	.globl _lookahead_offset
                                     12 	.globl b_SpriteCameraUpdate
                                     13 	.globl _SpriteCameraUpdate
                                     14 ;--------------------------------------------------------
                                     15 ; special function registers
                                     16 ;--------------------------------------------------------
                                     17 	.area _HRAM
                                     18 ;--------------------------------------------------------
                                     19 ; ram data
                                     20 ;--------------------------------------------------------
                                     21 	.area _DATA
    00000000                         22 _lookahead_offset::
    00000000                         23 	.ds 1
                                     24 ;--------------------------------------------------------
                                     25 ; ram data
                                     26 ;--------------------------------------------------------
                                     27 	.area _INITIALIZED
    00000000                         28 ___CRASH_HANDLER_INIT:
    00000000                         29 	.ds 2
                                     30 ;--------------------------------------------------------
                                     31 ; absolute external ram data
                                     32 ;--------------------------------------------------------
                                     33 	.area _DABS (ABS)
                                     34 ;--------------------------------------------------------
                                     35 ; global & static initialisations
                                     36 ;--------------------------------------------------------
                                     37 	.area _HOME
                                     38 	.area _GSINIT
                                     39 	.area _GSFINAL
                                     40 	.area _GSINIT
                                     41 ;--------------------------------------------------------
                                     42 ; Home
                                     43 ;--------------------------------------------------------
                                     44 	.area _HOME
                                     45 	.area _HOME
                                     46 ;--------------------------------------------------------
                                     47 ; code
                                     48 ;--------------------------------------------------------
                                     49 	.area _CODE
                                     50 ;Camera.c:21: void SpriteCameraUpdate(Sprite* this) BANKED {
                                     51 ;	---------------------------------
                                     52 ; Function SpriteCameraUpdate
                                     53 ; ---------------------------------
                         00000000    54 	b_SpriteCameraUpdate	= 0
    00000000                         55 _SpriteCameraUpdate::
    00000000 E8 F6            [16]   56 	add	sp, #-10
                                     57 ;Camera.c:22: INT16 cam_pos_x = this->x - (SCREEN_WIDTH >> 1) + (this->coll_w >> 1) + CAM_OFFSET_X;
    00000002 F8 10            [12]   58 	ldhl	sp,	#16
    00000004 2A               [ 8]   59 	ld	a, (hl+)
    00000005 4F               [ 4]   60 	ld	c, a
    00000006 46               [ 8]   61 	ld	b, (hl)
    00000007 21 04 00         [12]   62 	ld	hl, #0x0004
    0000000A 09               [ 8]   63 	add	hl, bc
    0000000B 7E               [ 8]   64 	ld	a, (hl)
    0000000C CB 3F            [ 8]   65 	srl	a
    0000000E C6 B0            [ 8]   66 	add	a, #0xb0
    00000010 F8 07            [12]   67 	ldhl	sp,	#7
    00000012 22               [ 8]   68 	ld	(hl+), a
    00000013 59               [ 4]   69 	ld	e, c
    00000014 50               [ 4]   70 	ld	d, b
    00000015 1A               [ 8]   71 	ld	a, (de)
    00000016 22               [ 8]   72 	ld	(hl+), a
    00000017 13               [ 8]   73 	inc	de
    00000018 1A               [ 8]   74 	ld	a, (de)
    00000019 32               [ 8]   75 	ld	(hl-), a
    0000001A 2B               [ 8]   76 	dec	hl
    0000001B 2A               [ 8]   77 	ld	a, (hl+)
    0000001C 5F               [ 4]   78 	ld	e, a
    0000001D 07               [ 4]   79 	rlca
    0000001E 9F               [ 4]   80 	sbc	a, a
    0000001F 57               [ 4]   81 	ld	d, a
    00000020 2A               [ 8]   82 	ld	a,	(hl+)
    00000021 66               [ 8]   83 	ld	h, (hl)
    00000022 6F               [ 4]   84 	ld	l, a
    00000023 19               [ 8]   85 	add	hl, de
    00000024 33               [ 8]   86 	inc	sp
    00000025 33               [ 8]   87 	inc	sp
    00000026 E5               [16]   88 	push	hl
                                     89 ;Camera.c:23: UINT16 cam_lim_x = scroll_w - SCREEN_WIDTH;
    00000027 21r00r00         [12]   90 	ld	hl, #_scroll_w
    0000002A 2A               [ 8]   91 	ld	a, (hl+)
    0000002B 5F               [ 4]   92 	ld	e, a
    0000002C 56               [ 8]   93 	ld	d, (hl)
    0000002D 21 A0 00         [12]   94 	ld	hl, #0x00a0
    00000030 7B               [ 4]   95 	ld	a, e
    00000031 95               [ 4]   96 	sub	a, l
    00000032 5F               [ 4]   97 	ld	e, a
    00000033 7A               [ 4]   98 	ld	a, d
    00000034 9C               [ 4]   99 	sbc	a, h
    00000035 F8 03            [12]  100 	ldhl	sp,	#3
    00000037 32               [ 8]  101 	ld	(hl-), a
    00000038 73               [ 8]  102 	ld	(hl), e
                                    103 ;Camera.c:25: INT16 cam_pos_y = this->y - (SCREEN_HEIGHT >> 1) + (this->coll_h >> 1) + CAM_OFFSET_Y;
    00000039 21 05 00         [12]  104 	ld	hl, #0x0005
    0000003C 09               [ 8]  105 	add	hl, bc
    0000003D 7E               [ 8]  106 	ld	a, (hl)
    0000003E CB 3F            [ 8]  107 	srl	a
    00000040 C6 A0            [ 8]  108 	add	a, #0xa0
    00000042 69               [ 4]  109 	ld	l, c
    00000043 60               [ 4]  110 	ld	h, b
    00000044 23               [ 8]  111 	inc	hl
    00000045 23               [ 8]  112 	inc	hl
    00000046 5D               [ 4]  113 	ld	e, l
    00000047 54               [ 4]  114 	ld	d, h
    00000048 F5               [16]  115 	push	af
    00000049 1A               [ 8]  116 	ld	a, (de)
    0000004A F8 0A            [12]  117 	ldhl	sp,	#10
    0000004C 22               [ 8]  118 	ld	(hl+), a
    0000004D 13               [ 8]  119 	inc	de
    0000004E 1A               [ 8]  120 	ld	a, (de)
    0000004F 77               [ 8]  121 	ld	(hl), a
    00000050 F1               [12]  122 	pop	af
    00000051 5F               [ 4]  123 	ld	e, a
    00000052 07               [ 4]  124 	rlca
    00000053 9F               [ 4]  125 	sbc	a, a
    00000054 57               [ 4]  126 	ld	d, a
    00000055 F8 08            [12]  127 	ldhl	sp,	#8
    00000057 2A               [ 8]  128 	ld	a,	(hl+)
    00000058 66               [ 8]  129 	ld	h, (hl)
    00000059 6F               [ 4]  130 	ld	l, a
    0000005A 19               [ 8]  131 	add	hl, de
    0000005B E5               [16]  132 	push	hl
    0000005C 7D               [ 4]  133 	ld	a, l
    0000005D F8 06            [12]  134 	ldhl	sp,	#6
    0000005F 77               [ 8]  135 	ld	(hl), a
    00000060 E1               [12]  136 	pop	hl
    00000061 7C               [ 4]  137 	ld	a, h
    00000062 F8 05            [12]  138 	ldhl	sp,	#5
    00000064 77               [ 8]  139 	ld	(hl), a
                                    140 ;Camera.c:26: UINT16 cam_lim_y = scroll_h - SCREEN_HEIGHT;
    00000065 21r00r00         [12]  141 	ld	hl, #_scroll_h
    00000068 2A               [ 8]  142 	ld	a, (hl+)
    00000069 5F               [ 4]  143 	ld	e, a
    0000006A 56               [ 8]  144 	ld	d, (hl)
    0000006B 21 90 00         [12]  145 	ld	hl, #0x0090
    0000006E 7B               [ 4]  146 	ld	a, e
    0000006F 95               [ 4]  147 	sub	a, l
    00000070 5F               [ 4]  148 	ld	e, a
    00000071 7A               [ 4]  149 	ld	a, d
    00000072 9C               [ 4]  150 	sbc	a, h
    00000073 F8 07            [12]  151 	ldhl	sp,	#7
    00000075 32               [ 8]  152 	ld	(hl-), a
    00000076 73               [ 8]  153 	ld	(hl), e
                                    154 ;Camera.c:31: CUSTOM_DATA* data = (CUSTOM_DATA*)this->custom_data;
                                    155 ;Camera.c:32: if (data->dir < 0) {
    00000077 21 2C 00         [12]  156 	ld	hl, #0x2c
    0000007A 09               [ 8]  157 	add	hl, bc
    0000007B CB 7E            [12]  158 	bit	7, (hl)
                                    159 ;Camera.c:33: lookahead_update = -1;
                                    160 ;Camera.c:35: lookahead_update = 1;
    0000007D 0E FF            [ 8]  161 	ld	c, #0xff
    0000007F 20 02            [12]  162 	jr	NZ, 00103$
    00000081 0E 01            [ 8]  163 	ld	c, #0x01
    00000083                        164 00103$:
                                    165 ;Camera.c:44: lookahead_offset = CLAMP(lookahead_offset + lookahead_update, -LOOKAHEAD_PX, LOOKAHEAD_PX);
    00000083 FAr00r00         [16]  166 	ld	a, (_lookahead_offset)
    00000086 5F               [ 4]  167 	ld	e, a
    00000087 07               [ 4]  168 	rlca
    00000088 9F               [ 4]  169 	sbc	a, a
    00000089 57               [ 4]  170 	ld	d, a
    0000008A 79               [ 4]  171 	ld	a, c
    0000008B 6F               [ 4]  172 	ld	l, a
    0000008C 07               [ 4]  173 	rlca
    0000008D 9F               [ 4]  174 	sbc	a, a
    0000008E 67               [ 4]  175 	ld	h, a
    0000008F 19               [ 8]  176 	add	hl, de
    00000090 7D               [ 4]  177 	ld	a, l
    00000091 D6 F0            [ 8]  178 	sub	a, #0xf0
    00000093 7C               [ 4]  179 	ld	a, h
    00000094 17               [ 4]  180 	rla
    00000095 3F               [ 4]  181 	ccf
    00000096 1F               [ 4]  182 	rra
    00000097 DE 7F            [ 8]  183 	sbc	a, #0x7f
    00000099 30 05            [12]  184 	jr	NC, 00116$
    0000009B 01 F0 FF         [12]  185 	ld	bc, #0xfff0
    0000009E 18 26            [12]  186 	jr	00117$
    000000A0                        187 00116$:
    000000A0 5C               [ 4]  188 	ld	e, h
    000000A1 16 00            [ 8]  189 	ld	d, #0x00
    000000A3 3E 10            [ 8]  190 	ld	a, #0x10
    000000A5 BD               [ 4]  191 	cp	a, l
    000000A6 3E 00            [ 8]  192 	ld	a, #0x00
    000000A8 9C               [ 4]  193 	sbc	a, h
    000000A9 CB 7B            [ 8]  194 	bit	7, e
    000000AB 28 07            [12]  195 	jr	Z, 00169$
    000000AD CB 7A            [ 8]  196 	bit	7, d
    000000AF 20 08            [12]  197 	jr	NZ, 00170$
    000000B1 BF               [ 4]  198 	cp	a, a
    000000B2 18 05            [12]  199 	jr	00170$
    000000B4                        200 00169$:
    000000B4 CB 7A            [ 8]  201 	bit	7, d
    000000B6 28 01            [12]  202 	jr	Z, 00170$
    000000B8 37               [ 4]  203 	scf
    000000B9                        204 00170$:
    000000B9 30 05            [12]  205 	jr	NC, 00118$
    000000BB 01 10 00         [12]  206 	ld	bc, #0x0010
    000000BE 18 06            [12]  207 	jr	00119$
    000000C0                        208 00118$:
    000000C0 79               [ 4]  209 	ld	a, c
    000000C1 21r00r00         [12]  210 	ld	hl, #_lookahead_offset
    000000C4 86               [ 8]  211 	add	a, (hl)
    000000C5 4F               [ 4]  212 	ld	c, a
    000000C6                        213 00119$:
    000000C6                        214 00117$:
    000000C6 21r00r00         [12]  215 	ld	hl, #_lookahead_offset
    000000C9 71               [ 8]  216 	ld	(hl), c
                                    217 ;Camera.c:45: cam_pos_x += lookahead_offset;
    000000CA 7E               [ 8]  218 	ld	a, (hl)
    000000CB 4F               [ 4]  219 	ld	c, a
    000000CC 07               [ 4]  220 	rlca
    000000CD 9F               [ 4]  221 	sbc	a, a
    000000CE 47               [ 4]  222 	ld	b, a
    000000CF E1               [12]  223 	pop	hl
    000000D0 E5               [16]  224 	push	hl
    000000D1 09               [ 8]  225 	add	hl, bc
    000000D2 E5               [16]  226 	push	hl
    000000D3 7D               [ 4]  227 	ld	a, l
    000000D4 F8 0A            [12]  228 	ldhl	sp,	#10
    000000D6 77               [ 8]  229 	ld	(hl), a
    000000D7 E1               [12]  230 	pop	hl
    000000D8 7C               [ 4]  231 	ld	a, h
    000000D9 F8 09            [12]  232 	ldhl	sp,	#9
    000000DB 77               [ 8]  233 	ld	(hl), a
                                    234 ;Camera.c:48: if (cam_pos_x < 0) {
    000000DC CB 7E            [12]  235 	bit	7, (hl)
    000000DE 28 06            [12]  236 	jr	Z, 00107$
                                    237 ;Camera.c:49: cam_pos_x = 0;
    000000E0 2B               [ 8]  238 	dec	hl
    000000E1 AF               [ 4]  239 	xor	a, a
    000000E2 22               [ 8]  240 	ld	(hl+), a
    000000E3 77               [ 8]  241 	ld	(hl), a
    000000E4 18 18            [12]  242 	jr	00108$
    000000E6                        243 00107$:
                                    244 ;Camera.c:50: } else if (cam_pos_x > cam_lim_x) {
    000000E6 F8 08            [12]  245 	ldhl	sp,	#8
    000000E8 2A               [ 8]  246 	ld	a, (hl+)
    000000E9 4F               [ 4]  247 	ld	c, a
    000000EA 46               [ 8]  248 	ld	b, (hl)
    000000EB F8 02            [12]  249 	ldhl	sp,	#2
    000000ED 2A               [ 8]  250 	ld	a, (hl+)
    000000EE 91               [ 4]  251 	sub	a, c
    000000EF 7E               [ 8]  252 	ld	a, (hl)
    000000F0 98               [ 4]  253 	sbc	a, b
    000000F1 30 0B            [12]  254 	jr	NC, 00108$
                                    255 ;Camera.c:51: cam_pos_x = cam_lim_x;
    000000F3 2B               [ 8]  256 	dec	hl
    000000F4 7E               [ 8]  257 	ld	a, (hl)
    000000F5 F8 08            [12]  258 	ldhl	sp,	#8
    000000F7 77               [ 8]  259 	ld	(hl), a
    000000F8 F8 03            [12]  260 	ldhl	sp,	#3
    000000FA 7E               [ 8]  261 	ld	a, (hl)
    000000FB F8 09            [12]  262 	ldhl	sp,	#9
    000000FD 77               [ 8]  263 	ld	(hl), a
    000000FE                        264 00108$:
                                    265 ;Camera.c:53: if (cam_pos_y < 0) {
    000000FE F8 05            [12]  266 	ldhl	sp,	#5
    00000100 CB 7E            [12]  267 	bit	7, (hl)
    00000102 28 06            [12]  268 	jr	Z, 00112$
                                    269 ;Camera.c:54: cam_pos_y = 0;
    00000104 2B               [ 8]  270 	dec	hl
    00000105 AF               [ 4]  271 	xor	a, a
    00000106 22               [ 8]  272 	ld	(hl+), a
    00000107 77               [ 8]  273 	ld	(hl), a
    00000108 18 15            [12]  274 	jr	00113$
    0000010A                        275 00112$:
                                    276 ;Camera.c:55: } else if (cam_pos_y > cam_lim_y) {
    0000010A F8 04            [12]  277 	ldhl	sp,	#4
    0000010C 2A               [ 8]  278 	ld	a, (hl+)
    0000010D 4F               [ 4]  279 	ld	c, a
    0000010E 2A               [ 8]  280 	ld	a, (hl+)
    0000010F 47               [ 4]  281 	ld	b, a
    00000110 2A               [ 8]  282 	ld	a, (hl+)
    00000111 91               [ 4]  283 	sub	a, c
    00000112 7E               [ 8]  284 	ld	a, (hl)
    00000113 98               [ 4]  285 	sbc	a, b
    00000114 30 09            [12]  286 	jr	NC, 00113$
                                    287 ;Camera.c:56: cam_pos_y = cam_lim_y;
    00000116 2B               [ 8]  288 	dec	hl
    00000117 3A               [ 8]  289 	ld	a, (hl-)
    00000118 2B               [ 8]  290 	dec	hl
    00000119 77               [ 8]  291 	ld	(hl), a
    0000011A F8 07            [12]  292 	ldhl	sp,	#7
    0000011C 3A               [ 8]  293 	ld	a, (hl-)
    0000011D 2B               [ 8]  294 	dec	hl
    0000011E 77               [ 8]  295 	ld	(hl), a
    0000011F                        296 00113$:
                                    297 ;Camera.c:58: MoveScroll(cam_pos_x, cam_pos_y);
    0000011F F8 04            [12]  298 	ldhl	sp,	#4
    00000121 2A               [ 8]  299 	ld	a, (hl+)
    00000122 4F               [ 4]  300 	ld	c, a
    00000123 46               [ 8]  301 	ld	b, (hl)
    00000124 F8 08            [12]  302 	ldhl	sp,	#8
    00000126 2A               [ 8]  303 	ld	a, (hl+)
    00000127 5F               [ 4]  304 	ld	e, a
    00000128 56               [ 8]  305 	ld	d, (hl)
    00000129 CDr00r00         [24]  306 	call	_MoveScroll
                                    307 ;Camera.c:59: }
    0000012C E8 0A            [16]  308 	add	sp, #10
    0000012E C9               [16]  309 	ret
                                    310 	.area _CODE
                                    311 	.area _INITIALIZER
    00000000                        312 __xinit____CRASH_HANDLER_INIT:
    00000000r00r00                  313 	.dw ___HandleCrash
                                    314 	.area _CABS (ABS)
