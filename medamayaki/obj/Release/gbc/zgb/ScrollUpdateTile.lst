                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module ScrollUpdateTile
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _UPDATE_TILE
                                     11 	.globl _GetTileReplacement
                                     12 	.globl _SpriteManagerAdd
                                     13 	.globl _set_bkg_tile_xy
                                     14 	.globl _set_vram_byte
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 	.area _HRAM
                                     19 ;--------------------------------------------------------
                                     20 ; ram data
                                     21 ;--------------------------------------------------------
                                     22 	.area _DATA
    00000000                         23 _UPDATE_TILE_replacement_10000_263:
    00000000                         24 	.ds 1
    00000001                         25 _UPDATE_TILE_type_30000_266:
    00000001                         26 	.ds 1
    00000002                         27 _UPDATE_TILE_i_50000_268:
    00000002                         28 	.ds 1
    00000003                         29 _UPDATE_TILE_id_50000_268:
    00000003                         30 	.ds 2
                                     31 ;--------------------------------------------------------
                                     32 ; ram data
                                     33 ;--------------------------------------------------------
                                     34 	.area _INITIALIZED
                                     35 ;--------------------------------------------------------
                                     36 ; absolute external ram data
                                     37 ;--------------------------------------------------------
                                     38 	.area _DABS (ABS)
                                     39 ;--------------------------------------------------------
                                     40 ; global & static initialisations
                                     41 ;--------------------------------------------------------
                                     42 	.area _HOME
                                     43 	.area _GSINIT
                                     44 	.area _GSFINAL
                                     45 	.area _GSINIT
                                     46 ;--------------------------------------------------------
                                     47 ; Home
                                     48 ;--------------------------------------------------------
                                     49 	.area _HOME
                                     50 	.area _HOME
                                     51 ;--------------------------------------------------------
                                     52 ; code
                                     53 ;--------------------------------------------------------
                                     54 	.area _CODE
                                     55 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:15: void UPDATE_TILE(INT16 x, INT16 y) {
                                     56 ;	---------------------------------
                                     57 ; Function UPDATE_TILE
                                     58 ; ---------------------------------
    00000000                         59 _UPDATE_TILE::
    00000000 E8 F8            [16]   60 	add	sp, #-8
    00000002 F8 06            [12]   61 	ldhl	sp,	#6
    00000004 7B               [ 4]   62 	ld	a, e
    00000005 22               [ 8]   63 	ld	(hl+), a
    00000006 72               [ 8]   64 	ld	(hl), d
    00000007 F8 04            [12]   65 	ldhl	sp,	#4
    00000009 79               [ 4]   66 	ld	a, c
    0000000A 22               [ 8]   67 	ld	(hl+), a
                                     68 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:18: if(((UINT16)x >= scroll_tiles_w) || ((UINT16)y >= scroll_tiles_h)) { //This also checks x < 0 || y < 0
    0000000B 78               [ 4]   69 	ld	a, b
    0000000C 22               [ 8]   70 	ld	(hl+), a
    0000000D 2A               [ 8]   71 	ld	a, (hl+)
    0000000E 4F               [ 4]   72 	ld	c, a
    0000000F 46               [ 8]   73 	ld	b, (hl)
    00000010 21r00r00         [12]   74 	ld	hl, #_scroll_tiles_w
    00000013 79               [ 4]   75 	ld	a, c
    00000014 96               [ 8]   76 	sub	a, (hl)
    00000015 23               [ 8]   77 	inc	hl
    00000016 78               [ 4]   78 	ld	a, b
    00000017 9E               [ 8]   79 	sbc	a, (hl)
    00000018 30 0F            [12]   80 	jr	NC, 00109$
    0000001A F8 04            [12]   81 	ldhl	sp,	#4
    0000001C 2A               [ 8]   82 	ld	a, (hl+)
    0000001D 4F               [ 4]   83 	ld	c, a
    0000001E 46               [ 8]   84 	ld	b, (hl)
    0000001F 21r00r00         [12]   85 	ld	hl, #_scroll_tiles_h
    00000022 79               [ 4]   86 	ld	a, c
    00000023 96               [ 8]   87 	sub	a, (hl)
    00000024 23               [ 8]   88 	inc	hl
    00000025 78               [ 4]   89 	ld	a, b
    00000026 9E               [ 8]   90 	sbc	a, (hl)
    00000027 38 07            [12]   91 	jr	C, 00110$
    00000029                         92 00109$:
                                     93 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:19: replacement = 0;
    00000029 AF               [ 4]   94 	xor	a, a
    0000002A EAr00r00         [16]   95 	ld	(#_UPDATE_TILE_replacement_10000_263),a
    0000002D C3r07r01         [16]   96 	jp	00111$
    00000030                         97 00110$:
                                     98 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:22: replacement = *scroll_ptr;
    00000030 FAr00r00         [16]   99 	ld	a, (_scroll_ptr)
    00000033 21r01r00         [12]  100 	ld	hl, #_scroll_ptr + 1
    00000036 66               [ 8]  101 	ld	h, (hl)
    00000037 6F               [ 4]  102 	ld	l, a
    00000038 7E               [ 8]  103 	ld	a, (hl)
    00000039 EAr00r00         [16]  104 	ld	(#_UPDATE_TILE_replacement_10000_263),a
                                    105 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:23: type = GetTileReplacement(scroll_ptr, &replacement);
    0000003C 01r00r00         [12]  106 	ld	bc, #_UPDATE_TILE_replacement_10000_263
    0000003F FAr00r00         [16]  107 	ld	a, (_scroll_ptr)
    00000042 5F               [ 4]  108 	ld	e, a
    00000043 21r01r00         [12]  109 	ld	hl, #_scroll_ptr + 1
    00000046 56               [ 8]  110 	ld	d, (hl)
    00000047 CDr00r00         [24]  111 	call	_GetTileReplacement
    0000004A 21r01r00         [12]  112 	ld	hl, #_UPDATE_TILE_type_30000_266
    0000004D 77               [ 8]  113 	ld	(hl), a
                                    114 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:24: if(type != 255u) {
    0000004E 7E               [ 8]  115 	ld	a, (hl)
    0000004F 3C               [ 4]  116 	inc	a
    00000050 CAr07r01         [16]  117 	jp	Z, 00111$
                                    118 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:27: id = SPRITE_UNIQUE_ID(x, y);
    00000053 F8 06            [12]  119 	ldhl	sp,	#6
    00000055 3A               [ 8]  120 	ld	a, (hl-)
    00000056 2B               [ 8]  121 	dec	hl
    00000057 0E 00            [ 8]  122 	ld	c, #0x00
    00000059 46               [ 8]  123 	ld	b, (hl)
    0000005A 1E 00            [ 8]  124 	ld	e, #0x00
    0000005C EAr03r00         [16]  125 	ld	(_UPDATE_TILE_id_50000_268), a
    0000005F 78               [ 4]  126 	ld	a, b
    00000060 EAr04r00         [16]  127 	ld	(_UPDATE_TILE_id_50000_268 + 1), a
                                    128 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:28: for (i = VECTOR_LEN(sprite_manager_updatables); (i); i--) {
    00000063 FAr00r00         [16]  129 	ld	a, (#_sprite_manager_updatables + 0)
    00000066 EAr02r00         [16]  130 	ld	(#_UPDATE_TILE_i_50000_268),a
    00000069                        131 00117$:
    00000069 21r02r00         [12]  132 	ld	hl, #_UPDATE_TILE_i_50000_268
    0000006C 7E               [ 8]  133 	ld	a, (hl)
    0000006D B7               [ 4]  134 	or	a, a
    0000006E 28 39            [12]  135 	jr	Z, 00104$
                                    136 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:29: Sprite* s = sprite_manager_sprites[sprite_manager_updatables[i]];
    00000070 3Er00            [ 8]  137 	ld	a, #<(_sprite_manager_updatables)
    00000072 86               [ 8]  138 	add	a, (hl)
    00000073 4F               [ 4]  139 	ld	c, a
    00000074 3Es00            [ 8]  140 	ld	a, #>(_sprite_manager_updatables)
    00000076 CE 00            [ 8]  141 	adc	a, #0x00
    00000078 47               [ 4]  142 	ld	b, a
    00000079 0A               [ 8]  143 	ld	a, (bc)
    0000007A 26 00            [ 8]  144 	ld	h, #0x00
    0000007C 6F               [ 4]  145 	ld	l, a
    0000007D 29               [ 8]  146 	add	hl, hl
    0000007E 11r00r00         [12]  147 	ld	de, #_sprite_manager_sprites
    00000081 19               [ 8]  148 	add	hl, de
    00000082 2A               [ 8]  149 	ld	a, (hl+)
    00000083 4F               [ 4]  150 	ld	c, a
    00000084 46               [ 8]  151 	ld	b, (hl)
                                    152 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:30: if ((s->type == type) && (s->unique_id == id)) {
    00000085 21 1D 00         [12]  153 	ld	hl, #0x001d
    00000088 09               [ 8]  154 	add	hl, bc
    00000089 7E               [ 8]  155 	ld	a, (hl)
    0000008A 21r01r00         [12]  156 	ld	hl, #_UPDATE_TILE_type_30000_266
    0000008D 96               [ 8]  157 	sub	a, (hl)
    0000008E 20 13            [12]  158 	jr	NZ, 00118$
    00000090 21 1F 00         [12]  159 	ld	hl, #0x001f
    00000093 09               [ 8]  160 	add	hl, bc
    00000094 2A               [ 8]  161 	ld	a, (hl+)
    00000095 4F               [ 4]  162 	ld	c, a
    00000096 46               [ 8]  163 	ld	b, (hl)
    00000097 21r03r00         [12]  164 	ld	hl, #_UPDATE_TILE_id_50000_268
    0000009A 7E               [ 8]  165 	ld	a, (hl)
    0000009B 91               [ 4]  166 	sub	a, c
    0000009C 20 05            [12]  167 	jr	NZ, 00182$
    0000009E 23               [ 8]  168 	inc	hl
    0000009F 7E               [ 8]  169 	ld	a, (hl)
    000000A0 90               [ 4]  170 	sub	a, b
    000000A1 28 06            [12]  171 	jr	Z, 00104$
    000000A3                        172 00182$:
                                    173 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:31: break;
    000000A3                        174 00118$:
                                    175 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:28: for (i = VECTOR_LEN(sprite_manager_updatables); (i); i--) {
    000000A3 21r02r00         [12]  176 	ld	hl, #_UPDATE_TILE_i_50000_268
    000000A6 35               [12]  177 	dec	(hl)
    000000A7 18 C0            [12]  178 	jr	00117$
    000000A9                        179 00104$:
                                    180 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:34: if (i == 0) {
    000000A9 FAr02r00         [16]  181 	ld	a, (#_UPDATE_TILE_i_50000_268)
    000000AC B7               [ 4]  182 	or	a, a
    000000AD 20 58            [12]  183 	jr	NZ, 00111$
                                    184 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:35: UINT8 __save = CURRENT_BANK;
    000000AF F0r00            [12]  185 	ldh	a, (__current_bank + 0)
    000000B1 F8 03            [12]  186 	ldhl	sp,	#3
    000000B3 77               [ 8]  187 	ld	(hl), a
                                    188 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:36: SWITCH_ROM(spriteDataBanks[type]);
    000000B4 3Er00            [ 8]  189 	ld	a, #<(_spriteDataBanks)
    000000B6 21r01r00         [12]  190 	ld	hl, #_UPDATE_TILE_type_30000_266
    000000B9 86               [ 8]  191 	add	a, (hl)
    000000BA 4F               [ 4]  192 	ld	c, a
    000000BB 3Es00            [ 8]  193 	ld	a, #>(_spriteDataBanks)
    000000BD CE 00            [ 8]  194 	adc	a, #0x00
    000000BF 47               [ 4]  195 	ld	b, a
    000000C0 0A               [ 8]  196 	ld	a, (bc)
    000000C1 E0r00            [12]  197 	ldh	(__current_bank + 0), a
    000000C3 EAr00r00         [16]  198 	ld	(#_rROMB0),a
                                    199 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:37: UINT16 sprite_y = TILE_TO_PX(y + 1) - spriteDatas[type]->height;
    000000C6 F8 04            [12]  200 	ldhl	sp,	#4
    000000C8 2A               [ 8]  201 	ld	a, (hl+)
    000000C9 66               [ 8]  202 	ld	h, (hl)
    000000CA 6F               [ 4]  203 	ld	l, a
    000000CB 23               [ 8]  204 	inc	hl
    000000CC 29               [ 8]  205 	add	hl, hl
    000000CD 29               [ 8]  206 	add	hl, hl
    000000CE 29               [ 8]  207 	add	hl, hl
    000000CF 4D               [ 4]  208 	ld	c, l
    000000D0 44               [ 4]  209 	ld	b, h
    000000D1 FAr01r00         [16]  210 	ld	a, (_UPDATE_TILE_type_30000_266)
    000000D4 26 00            [ 8]  211 	ld	h, #0x00
    000000D6 6F               [ 4]  212 	ld	l, a
    000000D7 29               [ 8]  213 	add	hl, hl
    000000D8 11r00r00         [12]  214 	ld	de, #_spriteDatas
    000000DB 19               [ 8]  215 	add	hl, de
    000000DC 2A               [ 8]  216 	ld	a,	(hl+)
    000000DD 66               [ 8]  217 	ld	h, (hl)
    000000DE 6F               [ 4]  218 	ld	l, a
    000000DF 23               [ 8]  219 	inc	hl
    000000E0 5E               [ 8]  220 	ld	e, (hl)
    000000E1 16 00            [ 8]  221 	ld	d, #0x00
    000000E3 79               [ 4]  222 	ld	a, c
    000000E4 93               [ 4]  223 	sub	a, e
    000000E5 4F               [ 4]  224 	ld	c, a
    000000E6 78               [ 4]  225 	ld	a, b
    000000E7 9A               [ 4]  226 	sbc	a, d
    000000E8 47               [ 4]  227 	ld	b, a
                                    228 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:38: SWITCH_ROM(__save);
    000000E9 F8 03            [12]  229 	ldhl	sp,	#3
    000000EB 7E               [ 8]  230 	ld	a, (hl)
    000000EC E0r00            [12]  231 	ldh	(__current_bank + 0), a
    000000EE 7E               [ 8]  232 	ld	a, (hl)
    000000EF EAr00r00         [16]  233 	ld	(#_rROMB0),a
                                    234 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:39: SpriteManagerAdd(type, TILE_TO_PX(x), sprite_y);
    000000F2 F8 06            [12]  235 	ldhl	sp,	#6
    000000F4 2A               [ 8]  236 	ld	a, (hl+)
    000000F5 56               [ 8]  237 	ld	d, (hl)
    000000F6 87               [ 4]  238 	add	a, a
    000000F7 CB 12            [ 8]  239 	rl	d
    000000F9 87               [ 4]  240 	add	a, a
    000000FA CB 12            [ 8]  241 	rl	d
    000000FC 87               [ 4]  242 	add	a, a
    000000FD CB 12            [ 8]  243 	rl	d
    000000FF C5               [16]  244 	push	bc
    00000100 5F               [ 4]  245 	ld	e, a
    00000101 FAr01r00         [16]  246 	ld	a, (_UPDATE_TILE_type_30000_266)
    00000104 CDr00r00         [24]  247 	call	_SpriteManagerAdd
    00000107                        248 00111$:
                                    249 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:44: ScrollSetAttrTileXY(SCREEN_BKG_OFFSET_X + x + scroll_offset_x, y + scroll_offset_y, replacement, ((scroll_cptr) ? *scroll_cptr : scroll_tile_info[replacement]));
    00000107 21r01r00         [12]  250 	ld	hl, #_scroll_cptr + 1
    0000010A 3A               [ 8]  251 	ld	a, (hl-)
    0000010B B6               [ 8]  252 	or	a, (hl)
    0000010C 28 06            [12]  253 	jr	Z, 00121$
    0000010E 2A               [ 8]  254 	ld	a, (hl+)
    0000010F 66               [ 8]  255 	ld	h, (hl)
    00000110 6F               [ 4]  256 	ld	l, a
    00000111 7E               [ 8]  257 	ld	a, (hl)
    00000112 18 0D            [12]  258 	jr	00122$
    00000114                        259 00121$:
    00000114 3Er00            [ 8]  260 	ld	a, #<(_scroll_tile_info)
    00000116 21r00r00         [12]  261 	ld	hl, #_UPDATE_TILE_replacement_10000_263
    00000119 86               [ 8]  262 	add	a, (hl)
    0000011A 4F               [ 4]  263 	ld	c, a
    0000011B 3Es00            [ 8]  264 	ld	a, #>(_scroll_tile_info)
    0000011D CE 00            [ 8]  265 	adc	a, #0x00
    0000011F 47               [ 4]  266 	ld	b, a
    00000120 0A               [ 8]  267 	ld	a, (bc)
    00000121                        268 00122$:
    00000121 F8 00            [12]  269 	ldhl	sp,	#0
    00000123 77               [ 8]  270 	ld	(hl), a
    00000124 FAr00r00         [16]  271 	ld	a, (#_UPDATE_TILE_replacement_10000_263)
    00000127 F8 01            [12]  272 	ldhl	sp,	#1
    00000129 77               [ 8]  273 	ld	(hl), a
    0000012A F8 04            [12]  274 	ldhl	sp,	#4
    0000012C 3A               [ 8]  275 	ld	a, (hl-)
    0000012D 77               [ 8]  276 	ld	(hl), a
    0000012E FAr00r00         [16]  277 	ld	a, (_scroll_offset_y)
    00000131 86               [ 8]  278 	add	a, (hl)
    00000132 2B               [ 8]  279 	dec	hl
    00000133 77               [ 8]  280 	ld	(hl), a
    00000134 F8 06            [12]  281 	ldhl	sp,	#6
    00000136 7E               [ 8]  282 	ld	a, (hl)
    00000137 F8 03            [12]  283 	ldhl	sp,	#3
    00000139 77               [ 8]  284 	ld	(hl), a
    0000013A FAr00r00         [16]  285 	ld	a, (_scroll_offset_x)
    0000013D 86               [ 8]  286 	add	a, (hl)
                                    287 ;C:/CrossZGB/ZGB/common/include/Scroll.h:178: UINT8* addr = set_bkg_tile_xy(x, y, t);
    0000013E 2B               [ 8]  288 	dec	hl
    0000013F 2B               [ 8]  289 	dec	hl
    00000140 66               [ 8]  290 	ld	h, (hl)
    00000141 E5               [16]  291 	push	hl
    00000142 33               [ 8]  292 	inc	sp
    00000143 F8 03            [12]  293 	ldhl	sp,	#3
    00000145 5E               [ 8]  294 	ld	e, (hl)
    00000146 CDr00r00         [24]  295 	call	_set_bkg_tile_xy
                                    296 ;C:/CrossZGB/ZGB/common/include/Scroll.h:180: if (_cpu == CGB_TYPE) {
    00000149 FAr00r00         [16]  297 	ld	a, (#__cpu)
    0000014C D6 11            [ 8]  298 	sub	a, #0x11
    0000014E 20 0F            [12]  299 	jr	NZ, 00119$
                                    300 ;C:/CrossZGB/ZGB/common/include/Scroll.h:181: VBK_REG = 1;
    00000150 3E 01            [ 8]  301 	ld	a, #0x01
    00000152 E0r00            [12]  302 	ldh	(_VBK_REG + 0), a
                                    303 ;C:/CrossZGB/ZGB/common/include/Scroll.h:182: set_vram_byte(addr, c);
    00000154 F8 00            [12]  304 	ldhl	sp,	#0
    00000156 7E               [ 8]  305 	ld	a, (hl)
    00000157 59               [ 4]  306 	ld	e, c
    00000158 50               [ 4]  307 	ld	d, b
    00000159 CDr00r00         [24]  308 	call	_set_vram_byte
                                    309 ;C:/CrossZGB/ZGB/common/include/Scroll.h:183: VBK_REG = 0;
    0000015C AF               [ 4]  310 	xor	a, a
    0000015D E0r00            [12]  311 	ldh	(_VBK_REG + 0), a
                                    312 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:44: ScrollSetAttrTileXY(SCREEN_BKG_OFFSET_X + x + scroll_offset_x, y + scroll_offset_y, replacement, ((scroll_cptr) ? *scroll_cptr : scroll_tile_info[replacement]));
    0000015F                        313 00119$:
                                    314 ;C:/CrossZGB/ZGB/common/src/ScrollUpdateTile.c:45: }
    0000015F E8 08            [16]  315 	add	sp, #8
    00000161 C9               [16]  316 	ret
                                    317 	.area _CODE
                                    318 	.area _INITIALIZER
                                    319 	.area _CABS (ABS)
