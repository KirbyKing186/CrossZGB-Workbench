                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module CoroutinesRunner
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _coro_init
                                     11 	.globl _coro_free_ctx
                                     12 	.globl _coro_contexts
                                     13 	.globl _coro_runner_init
                                     14 	.globl _coro_runner_alloc
                                     15 	.globl _coro_runner_free
                                     16 ;--------------------------------------------------------
                                     17 ; special function registers
                                     18 ;--------------------------------------------------------
                                     19 	.area _HRAM
                                     20 ;--------------------------------------------------------
                                     21 ; ram data
                                     22 ;--------------------------------------------------------
                                     23 	.area _DATA
    00000000                         24 _coro_contexts::
    00000000                         25 	.ds 1600
                                     26 ;--------------------------------------------------------
                                     27 ; ram data
                                     28 ;--------------------------------------------------------
                                     29 	.area _INITIALIZED
    00000000                         30 _coro_free_ctx::
    00000000                         31 	.ds 2
                                     32 ;--------------------------------------------------------
                                     33 ; absolute external ram data
                                     34 ;--------------------------------------------------------
                                     35 	.area _DABS (ABS)
                                     36 ;--------------------------------------------------------
                                     37 ; global & static initialisations
                                     38 ;--------------------------------------------------------
                                     39 	.area _HOME
                                     40 	.area _GSINIT
                                     41 	.area _GSFINAL
                                     42 	.area _GSINIT
                                     43 ;--------------------------------------------------------
                                     44 ; Home
                                     45 ;--------------------------------------------------------
                                     46 	.area _HOME
                                     47 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:34: static void __initializer__(void) NONBANKED NAKED {
                                     48 ;	---------------------------------
                                     49 ; Function __initializer__
                                     50 ; ---------------------------------
    00000000                         51 ___initializer__:
                                     52 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:46: __endasm;
                                     53 ;	we inject the call to the coro_runner_init() in the _GSINIT section,
                                     54 ;	so there will be no need to call it explicitly in the game code
                                     55 	.AREA	_GSINIT
    00000000 CDr00r00         [24]   56 	call	_coro_runner_init
                                     57 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:47: }
                                     58 	.area _HOME
                                     59 ;--------------------------------------------------------
                                     60 ; code
                                     61 ;--------------------------------------------------------
                                     62 	.area _CODE
                                     63 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:10: void coro_runner_init(void) {
                                     64 ;	---------------------------------
                                     65 ; Function coro_runner_init
                                     66 ; ---------------------------------
    00000000                         67 _coro_runner_init::
                                     68 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:11: coro_free_ctx = NULL;
    00000000 AF               [ 4]   69 	xor	a, a
    00000001 21r00r00         [12]   70 	ld	hl, #_coro_free_ctx
    00000004 22               [ 8]   71 	ld	(hl+), a
    00000005 77               [ 8]   72 	ld	(hl), a
                                     73 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:12: for (coro_runner_context_t * i = coro_contexts; i != (coro_contexts + CORO_MAX_CONTEXTS); i++) {
    00000006 01r00r00         [12]   74 	ld	bc, #_coro_contexts
    00000009                         75 00103$:
    00000009 3Er40            [ 8]   76 	ld	a, #<((_coro_contexts + 1600))
    0000000B 91               [ 4]   77 	sub	a, c
    0000000C 20 04            [12]   78 	jr	NZ, 00122$
    0000000E 3Es06            [ 8]   79 	ld	a, #>((_coro_contexts + 1600))
    00000010 90               [ 4]   80 	sub	a, b
    00000011 C8               [20]   81 	ret	Z
    00000012                         82 00122$:
                                     83 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:13: i->next = coro_free_ctx;
    00000012 21 62 00         [12]   84 	ld	hl, #0x0062
    00000015 09               [ 8]   85 	add	hl, bc
    00000016 FAr00r00         [16]   86 	ld	a, (_coro_free_ctx)
    00000019 22               [ 8]   87 	ld	(hl+), a
    0000001A FAr01r00         [16]   88 	ld	a, (_coro_free_ctx + 1)
    0000001D 77               [ 8]   89 	ld	(hl), a
                                     90 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:14: coro_free_ctx = i;
    0000001E 21r00r00         [12]   91 	ld	hl, #_coro_free_ctx
    00000021 79               [ 4]   92 	ld	a, c
    00000022 22               [ 8]   93 	ld	(hl+), a
    00000023 70               [ 8]   94 	ld	(hl), b
                                     95 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:12: for (coro_runner_context_t * i = coro_contexts; i != (coro_contexts + CORO_MAX_CONTEXTS); i++) {
    00000024 21 64 00         [12]   96 	ld	hl, #0x0064
    00000027 09               [ 8]   97 	add	hl, bc
    00000028 4D               [ 4]   98 	ld	c, l
    00000029 44               [ 4]   99 	ld	b, h
                                    100 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:16: }
    0000002A 18 DD            [12]  101 	jr	00103$
                                    102 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:18: void * coro_runner_alloc(coro_t coro, uint8_t coro_bank, void * user_data) {
                                    103 ;	---------------------------------
                                    104 ; Function coro_runner_alloc
                                    105 ; ---------------------------------
    0000002C                        106 _coro_runner_alloc::
    0000002C E8 FB            [16]  107 	add	sp, #-5
    0000002E F8 03            [12]  108 	ldhl	sp,	#3
    00000030 73               [ 8]  109 	ld	(hl), e
    00000031 23               [ 8]  110 	inc	hl
    00000032 72               [ 8]  111 	ld	(hl), d
    00000033 2B               [ 8]  112 	dec	hl
    00000034 2B               [ 8]  113 	dec	hl
    00000035 77               [ 8]  114 	ld	(hl), a
                                    115 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:19: if (coro_free_ctx) {
    00000036 21r01r00         [12]  116 	ld	hl, #_coro_free_ctx + 1
    00000039 3A               [ 8]  117 	ld	a, (hl-)
    0000003A B6               [ 8]  118 	or	a, (hl)
    0000003B 28 37            [12]  119 	jr	Z, 00102$
                                    120 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:20: coro_runner_context_t * tmp = coro_free_ctx;
    0000003D 7E               [ 8]  121 	ld	a, (hl)
    0000003E F8 00            [12]  122 	ldhl	sp,	#0
    00000040 77               [ 8]  123 	ld	(hl), a
    00000041 FAr01r00         [16]  124 	ld	a, (#_coro_free_ctx + 1)
    00000044 F8 01            [12]  125 	ldhl	sp,	#1
    00000046 77               [ 8]  126 	ld	(hl), a
                                    127 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:21: coro_free_ctx = tmp->next;
    00000047 D1               [12]  128 	pop	de
    00000048 D5               [16]  129 	push	de
    00000049 21 62 00         [12]  130 	ld	hl, #0x0062
    0000004C 19               [ 8]  131 	add	hl, de
    0000004D 4D               [ 4]  132 	ld	c, l
    0000004E 44               [ 4]  133 	ld	b, h
    0000004F 59               [ 4]  134 	ld	e, c
    00000050 50               [ 4]  135 	ld	d, b
    00000051 1A               [ 8]  136 	ld	a, (de)
    00000052 21r00r00         [12]  137 	ld	hl, #_coro_free_ctx
    00000055 22               [ 8]  138 	ld	(hl+), a
    00000056 13               [ 8]  139 	inc	de
    00000057 1A               [ 8]  140 	ld	a, (de)
    00000058 77               [ 8]  141 	ld	(hl), a
                                    142 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:22: coro_init(&tmp->coro_context, coro, coro_bank, user_data, CORO_STACK_SIZE);
    00000059 D1               [12]  143 	pop	de
    0000005A D5               [16]  144 	push	de
    0000005B 01 60 00         [12]  145 	ld	bc, #0x0060
    0000005E C5               [16]  146 	push	bc
    0000005F F8 09            [12]  147 	ldhl	sp,	#9
    00000061 2A               [ 8]  148 	ld	a, (hl+)
    00000062 4F               [ 4]  149 	ld	c, a
    00000063 46               [ 8]  150 	ld	b, (hl)
    00000064 C5               [16]  151 	push	bc
    00000065 F8 06            [12]  152 	ldhl	sp,	#6
    00000067 2A               [ 8]  153 	ld	a, (hl+)
    00000068 F5               [16]  154 	push	af
    00000069 33               [ 8]  155 	inc	sp
    0000006A 2A               [ 8]  156 	ld	a, (hl+)
    0000006B 4F               [ 4]  157 	ld	c, a
    0000006C 46               [ 8]  158 	ld	b, (hl)
    0000006D CDr00r00         [24]  159 	call	_coro_init
                                    160 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:23: return tmp;
    00000070 C1               [12]  161 	pop	bc
    00000071 C5               [16]  162 	push	bc
    00000072 18 03            [12]  163 	jr	00103$
    00000074                        164 00102$:
                                    165 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:25: return NULL;
    00000074 01 00 00         [12]  166 	ld	bc, #0x0000
    00000077                        167 00103$:
                                    168 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:26: }
    00000077 E8 05            [16]  169 	add	sp, #5
    00000079 E1               [12]  170 	pop	hl
    0000007A F1               [12]  171 	pop	af
    0000007B E9               [ 4]  172 	jp	(hl)
                                    173 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:28: void coro_runner_free(void * ctx) {
                                    174 ;	---------------------------------
                                    175 ; Function coro_runner_free
                                    176 ; ---------------------------------
    0000007C                        177 _coro_runner_free::
                                    178 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:29: if (!ctx) return;
    0000007C 7A               [ 4]  179 	ld	a, d
    0000007D B3               [ 4]  180 	or	a, e
    0000007E C8               [20]  181 	ret	Z
                                    182 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:30: ((coro_runner_context_t *)ctx)->next = coro_free_ctx;
    0000007F 21 62 00         [12]  183 	ld	hl, #0x0062
    00000082 19               [ 8]  184 	add	hl, de
    00000083 FAr00r00         [16]  185 	ld	a, (_coro_free_ctx)
    00000086 22               [ 8]  186 	ld	(hl+), a
    00000087 FAr01r00         [16]  187 	ld	a, (_coro_free_ctx + 1)
    0000008A 77               [ 8]  188 	ld	(hl), a
                                    189 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:31: coro_free_ctx = (coro_runner_context_t *)ctx;
    0000008B 21r00r00         [12]  190 	ld	hl, #_coro_free_ctx
    0000008E 7B               [ 4]  191 	ld	a, e
    0000008F 22               [ 8]  192 	ld	(hl+), a
    00000090 72               [ 8]  193 	ld	(hl), d
                                    194 ;C:/CrossZGB/ZGB/common/src/CoroutinesRunner.c:32: }
    00000091 C9               [16]  195 	ret
                                    196 	.area _CODE
                                    197 	.area _INITIALIZER
    00000000                        198 __xinit__coro_free_ctx:
    00000000 00 00                  199 	.dw #0x0000
                                    200 	.area _CABS (ABS)
