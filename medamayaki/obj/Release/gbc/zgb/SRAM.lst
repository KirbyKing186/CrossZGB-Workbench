                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module SRAM
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _memset
                                     11 	.globl _strcmp
                                     12 	.globl _strcpy
                                     13 	.globl b_CheckSRAMIntegrity
                                     14 	.globl _CheckSRAMIntegrity
                                     15 ;--------------------------------------------------------
                                     16 ; special function registers
                                     17 ;--------------------------------------------------------
                                     18 	.area _HRAM
                                     19 ;--------------------------------------------------------
                                     20 ; ram data
                                     21 ;--------------------------------------------------------
                                     22 	.area _DATA
                                     23 ;--------------------------------------------------------
                                     24 ; ram data
                                     25 ;--------------------------------------------------------
                                     26 	.area _INITIALIZED
                                     27 ;--------------------------------------------------------
                                     28 ; absolute external ram data
                                     29 ;--------------------------------------------------------
                                     30 	.area _DABS (ABS)
                                     31 ;--------------------------------------------------------
                                     32 ; global & static initialisations
                                     33 ;--------------------------------------------------------
                                     34 	.area _HOME
                                     35 	.area _GSINIT
                                     36 	.area _GSFINAL
                                     37 	.area _GSINIT
                                     38 ;--------------------------------------------------------
                                     39 ; Home
                                     40 ;--------------------------------------------------------
                                     41 	.area _HOME
                                     42 	.area _HOME
                                     43 ;--------------------------------------------------------
                                     44 ; code
                                     45 ;--------------------------------------------------------
                                     46 	.area _CODE_1
                                     47 ;C:/CrossZGB/ZGB/common/src/SRAM.c:10: void CheckSRAMIntegrity(UINT8* ptr, UINT16 size) BANKED {
                                     48 ;	---------------------------------
                                     49 ; Function CheckSRAMIntegrity
                                     50 ; ---------------------------------
                         00000001    51 	b_CheckSRAMIntegrity	= 1
    00000000                         52 _CheckSRAMIntegrity::
    00000000 E8 FC            [16]   53 	add	sp, #-4
                                     54 ;C:/CrossZGB/ZGB/common/src/SRAM.c:11: ENABLE_RAM;
    00000002 21r00r00         [12]   55 	ld	hl, #_rRAMG
    00000005 36 0A            [12]   56 	ld	(hl), #0x0a
                                     57 ;C:/CrossZGB/ZGB/common/src/SRAM.c:12: SWITCH_RAM(0);
    00000007 AF               [ 4]   58 	xor	a, a
    00000008 EAr00r00         [16]   59 	ld	(#_rRAMB),a
                                     60 ;C:/CrossZGB/ZGB/common/src/SRAM.c:13: UINT16 bytes_to_clear = 0;
    0000000B 01 00 00         [12]   61 	ld	bc, #0x0000
                                     62 ;C:/CrossZGB/ZGB/common/src/SRAM.c:14: UINT16* bytes_stored = (UINT16*)(ptr + MAGIC_LENGTH);
    0000000E F8 0A            [12]   63 	ldhl	sp,#10
    00000010 2A               [ 8]   64 	ld	a, (hl+)
    00000011 5F               [ 4]   65 	ld	e, a
    00000012 56               [ 8]   66 	ld	d, (hl)
    00000013 21 09 00         [12]   67 	ld	hl, #0x0009
    00000016 19               [ 8]   68 	add	hl, de
    00000017 33               [ 8]   69 	inc	sp
    00000018 33               [ 8]   70 	inc	sp
    00000019 E5               [16]   71 	push	hl
                                     72 ;C:/CrossZGB/ZGB/common/src/SRAM.c:15: if(strcmp((char*)ptr, MAGIC) != 0) {
    0000001A F8 0A            [12]   73 	ldhl	sp,	#10
    0000001C 2A               [ 8]   74 	ld	a, (hl+)
    0000001D 5F               [ 4]   75 	ld	e, a
    0000001E 56               [ 8]   76 	ld	d, (hl)
    0000001F 21rBFr00         [12]   77 	ld	hl, #___str_0
    00000022 E5               [16]   78 	push	hl
    00000023 D5               [16]   79 	push	de
    00000024 CDr00r00         [24]   80 	call	_strcmp
    00000027 E8 04            [16]   81 	add	sp, #4
    00000029 7A               [ 4]   82 	ld	a, d
    0000002A B3               [ 4]   83 	or	a, e
    0000002B 28 20            [12]   84 	jr	Z, 00104$
                                     85 ;C:/CrossZGB/ZGB/common/src/SRAM.c:16: strcpy(ptr, MAGIC);
    0000002D 11rBFr00         [12]   86 	ld	de, #___str_0
    00000030 D5               [16]   87 	push	de
    00000031 F8 0C            [12]   88 	ldhl	sp,	#12
    00000033 2A               [ 8]   89 	ld	a, (hl+)
    00000034 5F               [ 4]   90 	ld	e, a
    00000035 56               [ 8]   91 	ld	d, (hl)
    00000036 D5               [16]   92 	push	de
    00000037 CDr00r00         [24]   93 	call	_strcpy
    0000003A E8 04            [16]   94 	add	sp, #4
                                     95 ;C:/CrossZGB/ZGB/common/src/SRAM.c:18: bytes_to_clear = size - MAGIC_LENGTH - 2;
    0000003C F8 0C            [12]   96 	ldhl	sp,#12
    0000003E 2A               [ 8]   97 	ld	a, (hl+)
    0000003F 5F               [ 4]   98 	ld	e, a
    00000040 56               [ 8]   99 	ld	d, (hl)
    00000041 21 0B 00         [12]  100 	ld	hl, #0x000b
    00000044 7B               [ 4]  101 	ld	a, e
    00000045 95               [ 4]  102 	sub	a, l
    00000046 5F               [ 4]  103 	ld	e, a
    00000047 7A               [ 4]  104 	ld	a, d
    00000048 9C               [ 4]  105 	sbc	a, h
    00000049 47               [ 4]  106 	ld	b, a
    0000004A 4B               [ 4]  107 	ld	c, e
    0000004B 18 28            [12]  108 	jr	00105$
    0000004D                        109 00104$:
                                    110 ;C:/CrossZGB/ZGB/common/src/SRAM.c:20: if(*bytes_stored < size) {
    0000004D D1               [12]  111 	pop	de
    0000004E D5               [16]  112 	push	de
    0000004F 1A               [ 8]  113 	ld	a, (de)
    00000050 F8 02            [12]  114 	ldhl	sp,	#2
    00000052 22               [ 8]  115 	ld	(hl+), a
    00000053 13               [ 8]  116 	inc	de
    00000054 1A               [ 8]  117 	ld	a, (de)
    00000055 77               [ 8]  118 	ld	(hl), a
    00000056 F8 02            [12]  119 	ldhl	sp,	#2
    00000058 5D               [ 4]  120 	ld	e, l
    00000059 54               [ 4]  121 	ld	d, h
    0000005A F8 0C            [12]  122 	ldhl	sp,	#12
    0000005C 1A               [ 8]  123 	ld	a, (de)
    0000005D 13               [ 8]  124 	inc	de
    0000005E 96               [ 8]  125 	sub	a, (hl)
    0000005F 23               [ 8]  126 	inc	hl
    00000060 1A               [ 8]  127 	ld	a, (de)
    00000061 9E               [ 8]  128 	sbc	a, (hl)
    00000062 30 11            [12]  129 	jr	NC, 00105$
                                    130 ;C:/CrossZGB/ZGB/common/src/SRAM.c:21: bytes_to_clear = size - *bytes_stored;
    00000064 F8 0C            [12]  131 	ldhl	sp,#12
    00000066 2A               [ 8]  132 	ld	a, (hl+)
    00000067 5F               [ 4]  133 	ld	e, a
    00000068 56               [ 8]  134 	ld	d, (hl)
    00000069 F8 02            [12]  135 	ldhl	sp,	#2
    0000006B 2A               [ 8]  136 	ld	a,	(hl+)
    0000006C 66               [ 8]  137 	ld	h, (hl)
    0000006D 6F               [ 4]  138 	ld	l, a
    0000006E 7B               [ 4]  139 	ld	a, e
    0000006F 95               [ 4]  140 	sub	a, l
    00000070 5F               [ 4]  141 	ld	e, a
    00000071 7A               [ 4]  142 	ld	a, d
    00000072 9C               [ 4]  143 	sbc	a, h
    00000073 47               [ 4]  144 	ld	b, a
    00000074 4B               [ 4]  145 	ld	c, e
    00000075                        146 00105$:
                                    147 ;C:/CrossZGB/ZGB/common/src/SRAM.c:25: if(*bytes_stored != size) {
    00000075 D1               [12]  148 	pop	de
    00000076 D5               [16]  149 	push	de
    00000077 1A               [ 8]  150 	ld	a, (de)
    00000078 F8 02            [12]  151 	ldhl	sp,	#2
    0000007A 22               [ 8]  152 	ld	(hl+), a
    0000007B 13               [ 8]  153 	inc	de
    0000007C 1A               [ 8]  154 	ld	a, (de)
    0000007D 77               [ 8]  155 	ld	(hl), a
    0000007E F8 0C            [12]  156 	ldhl	sp,	#12
    00000080 7E               [ 8]  157 	ld	a, (hl)
    00000081 F8 02            [12]  158 	ldhl	sp,	#2
    00000083 96               [ 8]  159 	sub	a, (hl)
    00000084 20 08            [12]  160 	jr	NZ, 00140$
    00000086 F8 0D            [12]  161 	ldhl	sp,	#13
    00000088 7E               [ 8]  162 	ld	a, (hl)
    00000089 F8 03            [12]  163 	ldhl	sp,	#3
    0000008B 96               [ 8]  164 	sub	a, (hl)
    0000008C 28 09            [12]  165 	jr	Z, 00107$
    0000008E                        166 00140$:
                                    167 ;C:/CrossZGB/ZGB/common/src/SRAM.c:26: *bytes_stored = size;
    0000008E D1               [12]  168 	pop	de
    0000008F D5               [16]  169 	push	de
    00000090 F8 0C            [12]  170 	ldhl	sp,	#12
    00000092 2A               [ 8]  171 	ld	a, (hl+)
    00000093 12               [ 8]  172 	ld	(de), a
    00000094 13               [ 8]  173 	inc	de
    00000095 7E               [ 8]  174 	ld	a, (hl)
    00000096 12               [ 8]  175 	ld	(de), a
    00000097                        176 00107$:
                                    177 ;C:/CrossZGB/ZGB/common/src/SRAM.c:29: if(bytes_to_clear > 0) {
    00000097 78               [ 4]  178 	ld	a, b
    00000098 B1               [ 4]  179 	or	a, c
    00000099 28 1D            [12]  180 	jr	Z, 00109$
                                    181 ;C:/CrossZGB/ZGB/common/src/SRAM.c:30: memset(ptr + size - bytes_to_clear, 0, bytes_to_clear);
    0000009B F8 0A            [12]  182 	ldhl	sp,#10
    0000009D 2A               [ 8]  183 	ld	a, (hl+)
    0000009E 5F               [ 4]  184 	ld	e, a
    0000009F 2A               [ 8]  185 	ld	a, (hl+)
    000000A0 57               [ 4]  186 	ld	d, a
    000000A1 2A               [ 8]  187 	ld	a,	(hl+)
    000000A2 66               [ 8]  188 	ld	h, (hl)
    000000A3 6F               [ 4]  189 	ld	l, a
    000000A4 19               [ 8]  190 	add	hl, de
    000000A5 5D               [ 4]  191 	ld	e, l
    000000A6 54               [ 4]  192 	ld	d, h
    000000A7 7B               [ 4]  193 	ld	a, e
    000000A8 91               [ 4]  194 	sub	a, c
    000000A9 5F               [ 4]  195 	ld	e, a
    000000AA 7A               [ 4]  196 	ld	a, d
    000000AB 98               [ 4]  197 	sbc	a, b
    000000AC C5               [16]  198 	push	bc
    000000AD 01 00 00         [12]  199 	ld	bc, #0x0000
    000000B0 C5               [16]  200 	push	bc
    000000B1 57               [ 4]  201 	ld	d, a
    000000B2 D5               [16]  202 	push	de
    000000B3 CDr00r00         [24]  203 	call	_memset
    000000B6 E8 06            [16]  204 	add	sp, #6
    000000B8                        205 00109$:
                                    206 ;C:/CrossZGB/ZGB/common/src/SRAM.c:32: DISABLE_RAM;
    000000B8 AF               [ 4]  207 	xor	a, a
    000000B9 EAr00r00         [16]  208 	ld	(#_rRAMG),a
                                    209 ;C:/CrossZGB/ZGB/common/src/SRAM.c:33: }
    000000BC E8 04            [16]  210 	add	sp, #4
    000000BE C9               [16]  211 	ret
    000000BF                        212 ___str_0:
    000000BF 5A 47 42 2D 53 41 56   213 	.ascii "ZGB-SAVE"
             45
    000000C7 00                     214 	.db 0x00
                                    215 	.area _CODE_1
                                    216 	.area _INITIALIZER
                                    217 	.area _CABS (ABS)
