                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module sfxplayer
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _sfx_play_sample
                                     11 	.globl _sfx_play_bank
                                     12 	.globl _sfx_frame_skip
                                     13 	.globl _sfx_play_isr
                                     14 ;--------------------------------------------------------
                                     15 ; special function registers
                                     16 ;--------------------------------------------------------
                                     17 	.area _HRAM
                                     18 ;--------------------------------------------------------
                                     19 ; ram data
                                     20 ;--------------------------------------------------------
                                     21 	.area _DATA
    00000000                         22 _sfx_frame_skip::
    00000000                         23 	.ds 1
                                     24 ;--------------------------------------------------------
                                     25 ; ram data
                                     26 ;--------------------------------------------------------
                                     27 	.area _INITIALIZED
    00000000                         28 _sfx_play_bank::
    00000000                         29 	.ds 1
    00000001                         30 _sfx_play_sample::
    00000001                         31 	.ds 2
                                     32 ;--------------------------------------------------------
                                     33 ; absolute external ram data
                                     34 ;--------------------------------------------------------
                                     35 	.area _DABS (ABS)
                                     36 ;--------------------------------------------------------
                                     37 ; global & static initialisations
                                     38 ;--------------------------------------------------------
                                     39 	.area _HOME
                                     40 	.area _GSINIT
                                     41 	.area _GSFINAL
                                     42 	.area _GSINIT
                                     43 ;--------------------------------------------------------
                                     44 ; Home
                                     45 ;--------------------------------------------------------
                                     46 	.area _HOME
                                     47 ;C:/CrossZGB/ZGB/common/src/gb/sfxplayer.c:18: UINT8 sfx_play_isr(void) NONBANKED NAKED {
                                     48 ;	---------------------------------
                                     49 ; Function sfx_play_isr
                                     50 ; ---------------------------------
    00000000                         51 _sfx_play_isr::
                                     52 ;C:/CrossZGB/ZGB/common/src/gb/sfxplayer.c:144: __endasm;
                                     53 	.macro	copy_reg ?lbl
                                     54 	sla	b
                                     55 	jr	nc, lbl
                                     56 	ld	a, (hl+)
                                     57 	ldh	(c), a
                                     58 lbl:
                                     59 	inc	c
                                     60 	.endm
    00000000 21r01r00         [12]   61 	ld	hl, #_sfx_play_sample
    00000003 2A               [ 8]   62 	ld	a, (hl+)
    00000004 5F               [ 4]   63 	ld	e, a
    00000005 B6               [ 8]   64 	or	(hl)
    00000006 C8               [20]   65 	ret	z ; return 0
    00000007 56               [ 8]   66 	ld	d, (hl)
    00000008 21r00r00         [12]   67 	ld	hl, #_sfx_frame_skip
    0000000B AF               [ 4]   68 	xor	a
    0000000C B6               [ 8]   69 	or	(hl)
    0000000D 28 02            [12]   70 	jr	z, 7$
    0000000F 35               [12]   71 	dec	(hl)
    00000010 C9               [16]   72 	ret	; A != 0 that returns 1
    00000011                         73 7$:
    00000011 62               [ 4]   74 	ld	h, d
    00000012 6B               [ 4]   75 	ld	l, e ; HL = current position inside the sample
    00000013 F0r00            [12]   76 	ldh	a, (__current_bank) ; save bank and switch
    00000015 5F               [ 4]   77 	ld	e, a
    00000016 FAr00r00         [16]   78 	ld	a, (_sfx_play_bank)
    00000019 3C               [ 4]   79 	inc	a ; 0xffu ?
    0000001A C8               [20]   80 	ret	z ; return 0
    0000001B 3D               [ 4]   81 	dec	a
    0000001C E0r00            [12]   82 	ldh	(__current_bank), a
    0000001E EAr00r00         [16]   83 	ld	(_rROMB0), a
    00000021 16 0F            [ 8]   84 	ld	d, #0x0f
    00000023 7E               [ 8]   85 	ld	a, (hl)
    00000024 CB 37            [ 8]   86 	swap	a
    00000026 A2               [ 4]   87 	and	d
    00000027 EAr00r00         [16]   88 	ld	(_sfx_frame_skip), a
    0000002A 2A               [ 8]   89 	ld	a, (hl+)
    0000002B A2               [ 4]   90 	and	d
    0000002C 57               [ 4]   91 	ld	d, a ; d = frame channel count
    0000002D CArC9r00         [16]   92 	jp	z, 6$
    00000030                         93 2$:
    00000030 2A               [ 8]   94 	ld	a, (hl+)
    00000031 47               [ 4]   95 	ld	b, a ; a = b = channel no + register mask
    00000032 E6 07            [ 8]   96 	and	#0b00000111
    00000034 FE 05            [ 8]   97 	cp	#5
    00000036 38 63            [12]   98 	jr	c, 3$
    00000038 FE 07            [ 8]   99 	cp	#7
    0000003A 28 59            [12]  100 	jr	z, 5$ ; terminator
    0000003C F0r00            [12]  101 	ldh	a, (_NR51_REG)
    0000003E 4F               [ 4]  102 	ld	c, a
    0000003F E6 BB            [ 8]  103 	and	#0b10111011
    00000041 E0r00            [12]  104 	ldh	(_NR51_REG), a
    00000043 AF               [ 4]  105 	xor	a
    00000044 EAr00r00         [16]  106 	ld	(_NR30_REG), a
                                    107 	.irp	ofs,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
                                    108 	ld	a, (hl+)
                                    109 	ldh	(__AUD3WAVERAM+ofs), a
                                    110 	.endm
    00000047 2A               [ 8]    1 	ld	a, (hl+)
    00000048 E0r00            [12]    2 	ldh	(__AUD3WAVERAM+0), a
    0000004A 2A               [ 8]    1 	ld	a, (hl+)
    0000004B E0r01            [12]    2 	ldh	(__AUD3WAVERAM+1), a
    0000004D 2A               [ 8]    1 	ld	a, (hl+)
    0000004E E0r02            [12]    2 	ldh	(__AUD3WAVERAM+2), a
    00000050 2A               [ 8]    1 	ld	a, (hl+)
    00000051 E0r03            [12]    2 	ldh	(__AUD3WAVERAM+3), a
    00000053 2A               [ 8]    1 	ld	a, (hl+)
    00000054 E0r04            [12]    2 	ldh	(__AUD3WAVERAM+4), a
    00000056 2A               [ 8]    1 	ld	a, (hl+)
    00000057 E0r05            [12]    2 	ldh	(__AUD3WAVERAM+5), a
    00000059 2A               [ 8]    1 	ld	a, (hl+)
    0000005A E0r06            [12]    2 	ldh	(__AUD3WAVERAM+6), a
    0000005C 2A               [ 8]    1 	ld	a, (hl+)
    0000005D E0r07            [12]    2 	ldh	(__AUD3WAVERAM+7), a
    0000005F 2A               [ 8]    1 	ld	a, (hl+)
    00000060 E0r08            [12]    2 	ldh	(__AUD3WAVERAM+8), a
    00000062 2A               [ 8]    1 	ld	a, (hl+)
    00000063 E0r09            [12]    2 	ldh	(__AUD3WAVERAM+9), a
    00000065 2A               [ 8]    1 	ld	a, (hl+)
    00000066 E0r0A            [12]    2 	ldh	(__AUD3WAVERAM+10), a
    00000068 2A               [ 8]    1 	ld	a, (hl+)
    00000069 E0r0B            [12]    2 	ldh	(__AUD3WAVERAM+11), a
    0000006B 2A               [ 8]    1 	ld	a, (hl+)
    0000006C E0r0C            [12]    2 	ldh	(__AUD3WAVERAM+12), a
    0000006E 2A               [ 8]    1 	ld	a, (hl+)
    0000006F E0r0D            [12]    2 	ldh	(__AUD3WAVERAM+13), a
    00000071 2A               [ 8]    1 	ld	a, (hl+)
    00000072 E0r0E            [12]    2 	ldh	(__AUD3WAVERAM+14), a
    00000074 2A               [ 8]    1 	ld	a, (hl+)
    00000075 E0r0F            [12]    2 	ldh	(__AUD3WAVERAM+15), a
    00000077 78               [ 4]  111 	ld	a, b
    00000078 FE 06            [ 8]  112 	cp	#6
    0000007A 20 14            [12]  113 	jr	nz, 9$ ; just load waveform, not play
    0000007C 3E 80            [ 8]  114 	ld	a, #0x80
    0000007E E0r00            [12]  115 	ldh	(_NR30_REG),a
    00000080 3E 3B            [ 8]  116 	ld	a, #((0x3b)) ; length of wave
    00000082 E0r00            [12]  117 	ldh	(_NR31_REG),a
    00000084 3E 20            [ 8]  118 	ld	a, #0x20 ; volume
    00000086 E0r00            [12]  119 	ldh	(_NR32_REG),a
    00000088 3E BB            [ 8]  120 	ld	a, #<((0x3BB | 0xc000))
    0000008A E0r00            [12]  121 	ldh	(_NR33_REG),a
    0000008C 3E C3            [ 8]  122 	ld	a, #>((0x3BB | 0xc000))
    0000008E E0r00            [12]  123 	ldh	(_NR34_REG),a
    00000090                        124 9$:
    00000090 79               [ 4]  125 	ld	a, c
    00000091 E0r00            [12]  126 	ldh	(_NR51_REG), a
    00000093 18 30            [12]  127 	jr	4$
    00000095                        128 5$:
                                    129 ; terminator
    00000095 21 00 00         [12]  130 	ld	hl, #0
    00000098 55               [ 4]  131 	ld	d, l
    00000099 18 2F            [12]  132 	jr	0$
    0000009B                        133 3$:
    0000009B 4F               [ 4]  134 	ld	c, a
    0000009C 87               [ 4]  135 	add	a
    0000009D 87               [ 4]  136 	add	a
    0000009E 81               [ 4]  137 	add	c
    0000009F C6r00            [ 8]  138 	add	#_NR10_REG
    000000A1 4F               [ 4]  139 	ld	c, a ; c = NR10_REG + (a & 7) * 5
                                    140 	.rept	5
                                    141 	copy_reg
                                    142 	.endm
    000000A2                          1 	copy_reg
    000000A2 CB 20            [ 8]    1 	sla	b
    000000A4 30 02            [12]    2 	jr	nc, 10000$
    000000A6 2A               [ 8]    3 	ld	a, (hl+)
    000000A7 E2               [ 8]    4 	ldh	(c), a
    000000A8                          5 10000$:
    000000A8 0C               [ 4]    6 	inc	c
    000000A9                          1 	copy_reg
    000000A9 CB 20            [ 8]    1 	sla	b
    000000AB 30 02            [12]    2 	jr	nc, 10001$
    000000AD 2A               [ 8]    3 	ld	a, (hl+)
    000000AE E2               [ 8]    4 	ldh	(c), a
    000000AF                          5 10001$:
    000000AF 0C               [ 4]    6 	inc	c
    000000B0                          1 	copy_reg
    000000B0 CB 20            [ 8]    1 	sla	b
    000000B2 30 02            [12]    2 	jr	nc, 10002$
    000000B4 2A               [ 8]    3 	ld	a, (hl+)
    000000B5 E2               [ 8]    4 	ldh	(c), a
    000000B6                          5 10002$:
    000000B6 0C               [ 4]    6 	inc	c
    000000B7                          1 	copy_reg
    000000B7 CB 20            [ 8]    1 	sla	b
    000000B9 30 02            [12]    2 	jr	nc, 10003$
    000000BB 2A               [ 8]    3 	ld	a, (hl+)
    000000BC E2               [ 8]    4 	ldh	(c), a
    000000BD                          5 10003$:
    000000BD 0C               [ 4]    6 	inc	c
    000000BE                          1 	copy_reg
    000000BE CB 20            [ 8]    1 	sla	b
    000000C0 30 02            [12]    2 	jr	nc, 10004$
    000000C2 2A               [ 8]    3 	ld	a, (hl+)
    000000C3 E2               [ 8]    4 	ldh	(c), a
    000000C4                          5 10004$:
    000000C4 0C               [ 4]    6 	inc	c
    000000C5                        143 4$:
    000000C5 15               [ 4]  144 	dec	d
    000000C6 C2r30r00         [16]  145 	jp	nz, 2$
    000000C9                        146 6$:
    000000C9 14               [ 4]  147 	inc	d ; return 1 if still playing
    000000CA                        148 0$:
    000000CA 7D               [ 4]  149 	ld	a, l ; save current position
    000000CB EAr01r00         [16]  150 	ld	(_sfx_play_sample), a
    000000CE 7C               [ 4]  151 	ld	a, h
    000000CF EAr02r00         [16]  152 	ld	(_sfx_play_sample + 1), a
    000000D2 7B               [ 4]  153 	ld	a, e ; restore bank
    000000D3 E0r00            [12]  154 	ldh	(__current_bank), a
    000000D5 EAr00r00         [16]  155 	ld	(_rROMB0), a
    000000D8 7A               [ 4]  156 	ld	a, d ; result in a
    000000D9 C9               [16]  157 	ret
                                    158 ;C:/CrossZGB/ZGB/common/src/gb/sfxplayer.c:153: }
                                    159 	.area _HOME
                                    160 ;--------------------------------------------------------
                                    161 ; code
                                    162 ;--------------------------------------------------------
                                    163 	.area _CODE
                                    164 	.area _CODE
                                    165 	.area _INITIALIZER
    00000000                        166 __xinit__sfx_play_bank:
    00000000 FF                     167 	.db #0xff	; 255
    00000001                        168 __xinit__sfx_play_sample:
    00000001 00 00                  169 	.dw #0x0000
                                    170 	.area _CABS (ABS)
