                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module Sound
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _sfx_buffer
                                     11 	.globl _PlayFx
                                     12 ;--------------------------------------------------------
                                     13 ; special function registers
                                     14 ;--------------------------------------------------------
                                     15 	.area _HRAM
                                     16 ;--------------------------------------------------------
                                     17 ; ram data
                                     18 ;--------------------------------------------------------
                                     19 	.area _DATA
    00000000                         20 _sfx_buffer::
    00000000                         21 	.ds 9
                                     22 ;--------------------------------------------------------
                                     23 ; ram data
                                     24 ;--------------------------------------------------------
                                     25 	.area _INITIALIZED
                                     26 ;--------------------------------------------------------
                                     27 ; absolute external ram data
                                     28 ;--------------------------------------------------------
                                     29 	.area _DABS (ABS)
                                     30 ;--------------------------------------------------------
                                     31 ; global & static initialisations
                                     32 ;--------------------------------------------------------
                                     33 	.area _HOME
                                     34 	.area _GSINIT
                                     35 	.area _GSFINAL
                                     36 	.area _GSINIT
                                     37 ;--------------------------------------------------------
                                     38 ; Home
                                     39 ;--------------------------------------------------------
                                     40 	.area _HOME
                                     41 	.area _HOME
                                     42 ;--------------------------------------------------------
                                     43 ; code
                                     44 ;--------------------------------------------------------
                                     45 	.area _CODE
                                     46 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:8: void PlayFx(SOUND_CHANNEL channel, UINT8 mute_frames, ...) {
                                     47 ;	---------------------------------
                                     48 ; Function PlayFx
                                     49 ; ---------------------------------
    00000000                         50 _PlayFx::
    00000000 E8 FA            [16]   51 	add	sp, #-6
                                     52 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:9: if (sfx_play_bank != SFX_STOP_BANK) return; // return is SFX is playing
    00000002 FAr00r00         [16]   53 	ld	a, (#_sfx_play_bank)
    00000005 3C               [ 4]   54 	inc	a
    00000006 C2rFBr00         [16]   55 	jp	NZ, 00135$
                                     56 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:11: sfx_buffer[0] = ((mute_frames & 0x0F) << 4) | 1; // one packet with delay and data
    00000009 F8 09            [12]   57 	ldhl	sp,	#9
    0000000B 7E               [ 8]   58 	ld	a, (hl)
    0000000C CB 37            [ 8]   59 	swap a
    0000000E E6 F0            [ 8]   60 	and	a, #0xf0
    00000010 CB C7            [ 8]   61 	set	0, a
    00000012 EAr00r00         [16]   62 	ld	(#_sfx_buffer),a
                                     63 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:15: if (channel & CHANNEL_1) { 
    00000015 F8 08            [12]   64 	ldhl	sp,	#8
    00000017 4E               [ 8]   65 	ld	c, (hl)
                                     66 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:16: sfx_buffer[1] = 0b11111000;
    00000018 21r01r00         [12]   67 	ld	hl, #_sfx_buffer + 1
                                     68 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:15: if (channel & CHANNEL_1) { 
    0000001B CB 41            [ 8]   69 	bit	0, c
    0000001D 28 06            [12]   70 	jr	Z, 00116$
                                     71 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:16: sfx_buffer[1] = 0b11111000;
    0000001F 36 F8            [12]   72 	ld	(hl), #0xf8
                                     73 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:17: len = 5;
    00000021 06 05            [ 8]   74 	ld	b, #0x05
    00000023 18 2A            [12]   75 	jr	00117$
    00000025                         76 00116$:
                                     77 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:18: } else if (channel & CHANNEL_2) { 
    00000025 CB 49            [ 8]   78 	bit	1, c
    00000027 28 06            [12]   79 	jr	Z, 00113$
                                     80 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:19: sfx_buffer[1] = 0b01111001;
    00000029 36 79            [12]   81 	ld	(hl), #0x79
                                     82 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:20: len = 4;
    0000002B 06 04            [ 8]   83 	ld	b, #0x04
    0000002D 18 20            [12]   84 	jr	00117$
    0000002F                         85 00113$:
                                     86 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:21: } else if (channel & CHANNEL_3) { 
    0000002F CB 51            [ 8]   87 	bit	2, c
    00000031 28 06            [12]   88 	jr	Z, 00110$
                                     89 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:22: sfx_buffer[1] = 0b11111010;
    00000033 36 FA            [12]   90 	ld	(hl), #0xfa
                                     91 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:23: len = 5;
    00000035 06 05            [ 8]   92 	ld	b, #0x05
    00000037 18 16            [12]   93 	jr	00117$
    00000039                         94 00110$:
                                     95 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:24: } else if (channel & CHANNEL_4) { 
    00000039 CB 59            [ 8]   96 	bit	3, c
    0000003B 28 06            [12]   97 	jr	Z, 00107$
                                     98 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:25: sfx_buffer[1] = 0b01111011;
    0000003D 36 7B            [12]   99 	ld	(hl), #0x7b
                                    100 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:26: len = 4;
    0000003F 06 04            [ 8]  101 	ld	b, #0x04
    00000041 18 0C            [12]  102 	jr	00117$
    00000043                        103 00107$:
                                    104 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:27: } else if (channel & CHANNEL_5) {
    00000043 CB 61            [ 8]  105 	bit	4, c
    00000045 28 06            [12]  106 	jr	Z, 00104$
                                    107 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:28: sfx_buffer[1] = 0b11100100;
    00000047 36 E4            [12]  108 	ld	(hl), #0xe4
                                    109 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:29: len = 3;
    00000049 06 03            [ 8]  110 	ld	b, #0x03
    0000004B 18 02            [12]  111 	jr	00117$
    0000004D                        112 00104$:
                                    113 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:30: } else len = 0;
    0000004D 06 00            [ 8]  114 	ld	b, #0x00
    0000004F                        115 00117$:
                                    116 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:32: UINT8 *ptr = sfx_buffer + 2;
    0000004F F8 00            [12]  117 	ldhl	sp,	#0
    00000051 3Er02            [ 8]  118 	ld	a, #<((_sfx_buffer + 2))
    00000053 22               [ 8]  119 	ld	(hl+), a
    00000054 36s00            [12]  120 	ld	(hl), #>((_sfx_buffer + 2))
                                    121 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:35: va_start(list, mute_frames);
    00000056 F8 0A            [12]  122 	ldhl	sp,#10
    00000058 5D               [ 4]  123 	ld	e, l
    00000059 54               [ 4]  124 	ld	d, h
    0000005A F8 02            [12]  125 	ldhl	sp,	#2
    0000005C 7B               [ 4]  126 	ld	a, e
    0000005D 22               [ 8]  127 	ld	(hl+), a
    0000005E 72               [ 8]  128 	ld	(hl), d
    0000005F                        129 00133$:
                                    130 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:37: *ptr++ = va_arg(list, INT16); // copy len registers to the temporary buffer
    0000005F D1               [12]  131 	pop	de
    00000060 D5               [16]  132 	push	de
    00000061 6B               [ 4]  133 	ld	l, e
    00000062 62               [ 4]  134 	ld	h, d
    00000063 23               [ 8]  135 	inc	hl
    00000064 E5               [16]  136 	push	hl
    00000065 7D               [ 4]  137 	ld	a, l
    00000066 F8 06            [12]  138 	ldhl	sp,	#6
    00000068 77               [ 8]  139 	ld	(hl), a
    00000069 E1               [12]  140 	pop	hl
    0000006A 7C               [ 4]  141 	ld	a, h
    0000006B F8 05            [12]  142 	ldhl	sp,	#5
    0000006D 77               [ 8]  143 	ld	(hl), a
                                    144 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:36: for(; len != 0; --len) {
    0000006E 78               [ 4]  145 	ld	a, b
    0000006F B7               [ 4]  146 	or	a, a
    00000070 28 20            [12]  147 	jr	Z, 00118$
                                    148 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:37: *ptr++ = va_arg(list, INT16); // copy len registers to the temporary buffer
    00000072 F8 02            [12]  149 	ldhl	sp,	#2
    00000074 2A               [ 8]  150 	ld	a, (hl+)
    00000075 5F               [ 4]  151 	ld	e, a
    00000076 3A               [ 8]  152 	ld	a, (hl-)
    00000077 57               [ 4]  153 	ld	d, a
    00000078 13               [ 8]  154 	inc	de
    00000079 13               [ 8]  155 	inc	de
    0000007A 7B               [ 4]  156 	ld	a, e
    0000007B 22               [ 8]  157 	ld	(hl+), a
    0000007C 72               [ 8]  158 	ld	(hl), d
    0000007D 1B               [ 8]  159 	dec	de
    0000007E 1B               [ 8]  160 	dec	de
    0000007F 1A               [ 8]  161 	ld	a, (de)
    00000080 E1               [12]  162 	pop	hl
    00000081 E5               [16]  163 	push	hl
    00000082 77               [ 8]  164 	ld	(hl), a
    00000083 F8 04            [12]  165 	ldhl	sp,	#4
    00000085 7E               [ 8]  166 	ld	a, (hl)
    00000086 F8 00            [12]  167 	ldhl	sp,	#0
    00000088 77               [ 8]  168 	ld	(hl), a
    00000089 F8 05            [12]  169 	ldhl	sp,	#5
    0000008B 7E               [ 8]  170 	ld	a, (hl)
    0000008C F8 01            [12]  171 	ldhl	sp,	#1
    0000008E 77               [ 8]  172 	ld	(hl), a
                                    173 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:36: for(; len != 0; --len) {
    0000008F 05               [ 4]  174 	dec	b
    00000090 18 CD            [12]  175 	jr	00133$
    00000092                        176 00118$:
                                    177 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:41: *ptr++ = 1; // one packet without delay and terminator
    00000092 E1               [12]  178 	pop	hl
    00000093 36 01            [12]  179 	ld	(hl), #0x01
    00000095 E5               [16]  180 	push	hl
    00000096 F8 04            [12]  181 	ldhl	sp,	#4
    00000098 2A               [ 8]  182 	ld	a, (hl+)
    00000099 5F               [ 4]  183 	ld	e, a
    0000009A 56               [ 8]  184 	ld	d, (hl)
                                    185 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:42: *ptr = 0x07; // add terminator
    0000009B 3E 07            [ 8]  186 	ld	a, #0x07
    0000009D 12               [ 8]  187 	ld	(de), a
                                    188 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:44: ExecuteSFX(CURRENT_BANK, sfx_buffer, channel, SFX_PRIORITY_NORMAL);
    0000009E F0r00            [12]  189 	ldh	a, (__current_bank + 0)
    000000A0 47               [ 4]  190 	ld	b, a
                                    191 ;C:/CrossZGB/ZGB/common/include/Sound.h:98: if (sfx_priority > priority) return;
    000000A1 3E 04            [ 8]  192 	ld	a, #0x04
    000000A3 21r00r00         [12]  193 	ld	hl, #_sfx_priority
    000000A6 96               [ 8]  194 	sub	a, (hl)
    000000A7 38 52            [12]  195 	jr	C, 00135$
                                    196 ;C:/CrossZGB/ZGB/common/include/Sound.h:99: sfx_play_bank = SFX_STOP_BANK;
    000000A9 21r00r00         [12]  197 	ld	hl, #_sfx_play_bank
    000000AC 36 FF            [12]  198 	ld	(hl), #0xff
                                    199 ;C:/CrossZGB/ZGB/common/include/Sound.h:100: sfx_priority = priority;
    000000AE 21r00r00         [12]  200 	ld	hl, #_sfx_priority
    000000B1 36 04            [12]  201 	ld	(hl), #0x04
                                    202 ;C:/CrossZGB/ZGB/common/include/Sound.h:101: sfx_sound_cut_mask(music_mute_mask);
    000000B3 FAr00r00         [16]  203 	ld	a, (_music_mute_mask)
    000000B6 5F               [ 4]  204 	ld	e, a
                                    205 ;C:/CrossZGB/ZGB/common/include/Sound.h:62: if (mask & SFX_CH_1) NR12_REG = 0, NR14_REG = SFX_CH_RETRIGGER;
    000000B7 0F               [ 4]  206 	rrca
    000000B8 30 07            [12]  207 	jr	NC, 00122$
    000000BA AF               [ 4]  208 	xor	a, a
    000000BB E0r00            [12]  209 	ldh	(_NR12_REG + 0), a
    000000BD 3E C0            [ 8]  210 	ld	a, #0xc0
    000000BF E0r00            [12]  211 	ldh	(_NR14_REG + 0), a
    000000C1                        212 00122$:
                                    213 ;C:/CrossZGB/ZGB/common/include/Sound.h:63: if (mask & SFX_CH_2) NR22_REG = 0, NR24_REG = SFX_CH_RETRIGGER;
    000000C1 CB 4B            [ 8]  214 	bit	1, e
    000000C3 28 07            [12]  215 	jr	Z, 00124$
    000000C5 AF               [ 4]  216 	xor	a, a
    000000C6 E0r00            [12]  217 	ldh	(_NR22_REG + 0), a
    000000C8 3E C0            [ 8]  218 	ld	a, #0xc0
    000000CA E0r00            [12]  219 	ldh	(_NR24_REG + 0), a
    000000CC                        220 00124$:
                                    221 ;C:/CrossZGB/ZGB/common/include/Sound.h:64: if (mask & SFX_CH_3) NR32_REG = 0;
    000000CC CB 53            [ 8]  222 	bit	2, e
    000000CE 28 03            [12]  223 	jr	Z, 00126$
    000000D0 AF               [ 4]  224 	xor	a, a
    000000D1 E0r00            [12]  225 	ldh	(_NR32_REG + 0), a
    000000D3                        226 00126$:
                                    227 ;C:/CrossZGB/ZGB/common/include/Sound.h:65: if (mask & SFX_CH_4) NR42_REG = 0, NR44_REG = SFX_CH_RETRIGGER;
    000000D3 CB 5B            [ 8]  228 	bit	3, e
    000000D5 28 07            [12]  229 	jr	Z, 00128$
    000000D7 AF               [ 4]  230 	xor	a, a
    000000D8 E0r00            [12]  231 	ldh	(_NR42_REG + 0), a
    000000DA 3E C0            [ 8]  232 	ld	a, #0xc0
    000000DC E0r00            [12]  233 	ldh	(_NR44_REG + 0), a
    000000DE                        234 00128$:
                                    235 ;C:/CrossZGB/ZGB/common/include/Sound.h:66: NR51_REG = 0xFF;
    000000DE 3E FF            [ 8]  236 	ld	a, #0xff
    000000E0 E0r00            [12]  237 	ldh	(_NR51_REG + 0), a
                                    238 ;C:/CrossZGB/ZGB/common/include/Sound.h:102: music_mute_mask = mute_mask;
    000000E2 21r00r00         [12]  239 	ld	hl, #_music_mute_mask
    000000E5 71               [ 8]  240 	ld	(hl), c
                                    241 ;C:/CrossZGB/ZGB/common/include/Sound.h:90: sfx_play_bank = SFX_STOP_BANK, sfx_frame_skip = 0, sfx_play_sample = sample, sfx_play_bank = bank;
    000000E6 21r00r00         [12]  242 	ld	hl, #_sfx_play_bank
    000000E9 36 FF            [12]  243 	ld	(hl), #0xff
    000000EB AF               [ 4]  244 	xor	a, a
    000000EC EAr00r00         [16]  245 	ld	(#_sfx_frame_skip),a
    000000EF 21r00r00         [12]  246 	ld	hl, #_sfx_play_sample
    000000F2 3Er00            [ 8]  247 	ld	a, #<(_sfx_buffer)
    000000F4 22               [ 8]  248 	ld	(hl+), a
    000000F5 36s00            [12]  249 	ld	(hl), #>(_sfx_buffer)
    000000F7 21r00r00         [12]  250 	ld	hl, #_sfx_play_bank
    000000FA 70               [ 8]  251 	ld	(hl), b
                                    252 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:44: ExecuteSFX(CURRENT_BANK, sfx_buffer, channel, SFX_PRIORITY_NORMAL);
    000000FB                        253 00135$:
                                    254 ;C:/CrossZGB/ZGB/common/src/gb/Sound.c:45: }
    000000FB E8 06            [16]  255 	add	sp, #6
    000000FD C9               [16]  256 	ret
                                    257 	.area _CODE
                                    258 	.area _INITIALIZER
                                    259 	.area _CABS (ABS)
